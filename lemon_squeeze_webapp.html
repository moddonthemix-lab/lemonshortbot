<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üçã Lemon Squeeze Web App v2.0</title>
    <style>
        :root {
            /* Light mode colors */
            --bg-gradient-start: #FFD700;
            --bg-gradient-end: #FFA500;
            --container-bg: #FFF9E6;
            --text-primary: #333;
            --text-secondary: #666;
            --card-bg: white;
            --border-color: #FFD700;
            --settings-bg: #FFE97F;
            --shadow: rgba(0,0,0,0.1);
            --shadow-heavy: rgba(0,0,0,0.3);
        }
        
        [data-theme="dark"] {
            /* Dark mode colors */
            --bg-gradient-start: #1a1a2e;
            --bg-gradient-end: #16213e;
            --container-bg: #0f3460;
            --text-primary: #eee;
            --text-secondary: #ccc;
            --card-bg: #1a1a2e;
            --border-color: #FFA500;
            --settings-bg: #16213e;
            --shadow: rgba(0,0,0,0.3);
            --shadow-heavy: rgba(0,0,0,0.5);
        }
        
        /* Fix text colors in dark mode for info boxes */
        [data-theme="dark"] .settings-panel div[style*="background: #FFE97F"],
        [data-theme="dark"] .settings-panel div[style*="background:#FFE97F"] {
            background: #2d3748 !important;
            color: #e2e8f0 !important;
        }
        
        [data-theme="dark"] .settings-panel div[style*="background: white"],
        [data-theme="dark"] .settings-panel div[style*="background:white"],
        [data-theme="dark"] .pattern-info div[style*="background: white"],
        [data-theme="dark"] .pattern-info div[style*="background:white"] {
            background: #1a202c !important;
            color: #e2e8f0 !important;
        }
        
        [data-theme="dark"] .settings-panel ul,
        [data-theme="dark"] .settings-panel p,
        [data-theme="dark"] .settings-panel li,
        [data-theme="dark"] .settings-panel strong {
            color: #e2e8f0 !important;
        }
        
        [data-theme="dark"] .pattern-info strong,
        [data-theme="dark"] .pattern-info p {
            color: #e2e8f0 !important;
        }
        
        /* Fix summary stats text in dark mode */
        [data-theme="dark"] .results-header p {
            color: #cbd5e0 !important;
        }
        
        /* Fix inline styled elements in dark mode */
        [data-theme="dark"] div[style*="color: #666"],
        [data-theme="dark"] div[style*="color:#666"],
        [data-theme="dark"] span[style*="color: #666"],
        [data-theme="dark"] p[style*="color: #666"] {
            color: #cbd5e0 !important;
        }
        
        [data-theme="dark"] div[style*="color: #999"],
        [data-theme="dark"] p[style*="color: #999"] {
            color: #a0aec0 !important;
        }
        
        /* Fix "no results" message */
        [data-theme="dark"] .no-results p {
            color: #cbd5e0 !important;
        }
        
        /* Make sure orange colors pop in dark mode */
        [data-theme="dark"] .settings-panel h2,
        [data-theme="dark"] .metric-section h4 {
            color: #fb923c !important;
        }
        
        /* Improve readability of all paragraph text in dark mode */
        [data-theme="dark"] p,
        [data-theme="dark"] li,
        [data-theme="dark"] span:not(.stat-value):not(.metric-value) {
            color: #e2e8f0;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1300px;
            margin: 0 auto;
            background: var(--container-bg);
            border-radius: 20px;
            box-shadow: 0 20px 60px var(--shadow-heavy);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
            color: var(--text-primary);
            padding: 40px;
            text-align: center;
            position: relative;
        }
        
        /* Toolbar - Desktop */
        .toolbar {
            background: var(--card-bg);
            padding: 15px 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            box-shadow: 0 2px 10px var(--shadow);
            border-bottom: 2px solid var(--border-color);
        }
        
        /* Floating actions - Hidden on desktop, shown on mobile */
        .floating-actions {
            display: none;
        }
        
        /* Dark Mode Toggle */
        .dark-mode-toggle {
            background: var(--settings-bg);
            border: 2px solid var(--border-color);
            border-radius: 50px;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 1em;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-primary);
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .dark-mode-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px var(--shadow);
            background: var(--border-color);
        }
        
        /* Favorites Button */
        .favorites-toggle {
            background: linear-gradient(135deg, #FFA500 0%, #FF8C00 100%);
            border: none;
            border-radius: 50px;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 1em;
            display: flex;
            align-items: center;
            gap: 8px;
            color: white;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(255, 165, 0, 0.3);
        }
        
        .favorites-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 165, 0, 0.5);
        }
        
        .favorites-count {
            background: white;
            color: #FFA500;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85em;
            font-weight: bold;
        }
        
        .header::before, .header::after {
            content: "üçã";
            position: absolute;
            font-size: 100px;
            opacity: 0.1;
            top: 20px;
        }
        
        .header::before { left: 50px; }
        .header::after { right: 50px; }
        
        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .header p {
            font-size: 1.3em;
            font-style: italic;
            opacity: 0.9;
        }
        
        .badge {
            display: inline-block;
            background: #FF6B6B;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-top: 10px;
            font-weight: bold;
        }
        
        /* Tab Navigation */
        .tabs {
            display: flex;
            justify-content: center;
            background: var(--settings-bg);
            padding: 0;
            margin: 0;
        }
        
        .tab-button {
            flex: 1;
            max-width: 200px;
            padding: 18px 15px;
            background: transparent;
            border: none;
            font-size: 1.05em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            color: var(--text-secondary);
            border-bottom: 4px solid transparent;
        }
        
        .tab-button:hover {
            background: var(--card-bg);
            opacity: 0.8;
        }
        
        .tab-button.active {
            background: var(--container-bg);
            color: #FFA500;
            border-bottom: 4px solid #FFA500;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .content {
            padding: 40px;
        }
        
        .settings-panel {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px var(--shadow);
            color: var(--text-primary);
        }
        
        .settings-panel h2 {
            color: #FFA500;
            margin-bottom: 20px;
            font-size: 1.5em;
        }
        
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .setting-item {
            display: flex;
            flex-direction: column;
        }
        
        label {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
            font-size: 1.1em;
        }
        
        input[type="number"] {
            padding: 12px;
            border: 3px solid var(--border-color);
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            transition: all 0.3s;
            background: var(--card-bg);
            color: var(--text-primary);
        }
        
        select {
            padding: 12px;
            border: 3px solid var(--border-color);
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            transition: all 0.3s;
            background: var(--card-bg);
            cursor: pointer;
            color: var(--text-primary);
        }
        
        input[type="number"]:focus, select:focus {
            outline: none;
            border-color: #FFA500;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
        }
        
        .scan-section {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .scan-button {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: #333;
            border: none;
            padding: 25px 60px;
            font-size: 28px;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 8px 25px rgba(255, 165, 0, 0.4);
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .scan-button:hover:not(:disabled) {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(255, 165, 0, 0.6);
        }
        
        .scan-button:active {
            transform: translateY(-2px);
        }
        
        .scan-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .loading.active {
            display: block;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #FFD700;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            font-size: 1.2em;
            color: #666;
            font-weight: 600;
        }
        
        .results {
            display: none;
        }
        
        .results.active {
            display: block;
        }
        
        .results-header {
            background: var(--card-bg);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px var(--shadow);
            text-align: center;
            color: var(--text-primary);
        }
        
        .results-header h2 {
            color: #FFA500;
            font-size: 2em;
            margin-bottom: 15px;
        }
        
        .summary-stats {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }
        
        .stat {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #FFA500;
        }
        
        .stat-label {
            font-size: 1em;
            color: var(--text-secondary);
            margin-top: 5px;
        }
        
        .stock-card, .pattern-card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px var(--shadow);
            transition: transform 0.3s, box-shadow 0.3s;
            color: var(--text-primary);
            position: relative;
        }
        
        .stock-card:hover, .pattern-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px var(--shadow-heavy);
        }
        
        /* Add to Favorites Button */
        .favorite-btn {
            background: transparent;
            border: 3px solid #FFA500;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            cursor: pointer;
            font-size: 1.6em;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            flex-shrink: 0;
        }
        
        .favorite-btn:hover {
            background: #FFA500;
            transform: scale(1.15) rotate(15deg);
            box-shadow: 0 6px 20px rgba(255, 165, 0, 0.5);
        }
        
        .favorite-btn.active {
            background: #FFA500;
            border-color: #FF8C00;
            box-shadow: 0 4px 15px rgba(255, 165, 0, 0.4);
        }
        
        /* Chart Container */
        .chart-container {
            width: 100%;
            height: 300px;
            margin: 20px 0;
            background: var(--container-bg);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .stock-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            gap: 15px;
        }
        
        .stock-title-row {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
        }
        
        .stock-ticker {
            font-size: 2em;
            font-weight: bold;
            color: var(--text-primary);
        }
        
        .stock-company {
            font-size: 1.2em;
            color: var(--text-secondary);
            margin-bottom: 20px;
        }
        
        .risk-badge {
            padding: 12px 20px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 1.2em;
        }
        
        .risk-extreme {
            background: linear-gradient(135deg, #FF0000 0%, #CC0000 100%);
            color: white;
            animation: pulse 2s ease-in-out infinite;
        }
        
        .risk-high {
            background: linear-gradient(135deg, #FF6B6B 0%, #FF4444 100%);
            color: white;
        }
        
        .risk-good {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        
        .risk-moderate {
            background: linear-gradient(135deg, #FFA500 0%, #FF8C00 100%);
            color: white;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .metric-section {
            background: var(--settings-bg);
            padding: 15px;
            border-radius: 10px;
        }
        
        .metric-section h4 {
            color: #FFA500;
            margin-bottom: 12px;
            font-size: 1.1em;
        }
        
        .metric-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
        }
        
        .metric-item:last-child {
            border-bottom: none;
        }
        
        .metric-label {
            color: var(--text-secondary);
            font-weight: 600;
        }
        
        .metric-value {
            color: var(--text-primary);
            font-weight: bold;
        }
        
        .pattern-info {
            background: var(--settings-bg);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
        }
        
        .pattern-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            margin: 5px;
        }
        
        .pattern-bullish {
            background: #10b981;
            color: white;
        }
        
        .pattern-bearish {
            background: #ef4444;
            color: white;
        }
        
        .no-results {
            background: var(--card-bg);
            padding: 50px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 4px 15px var(--shadow);
            color: var(--text-primary);
        }
        
        .no-results h3 {
            font-size: 2em;
            color: #FFA500;
            margin-bottom: 20px;
        }
        
        /* Favorites Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 20px;
            max-width: 800px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px var(--shadow-heavy);
            color: var(--text-primary);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 15px;
        }
        
        .modal-header h2 {
            color: #FFA500;
            font-size: 2em;
        }
        
        .modal-close {
            background: transparent;
            border: none;
            font-size: 2em;
            cursor: pointer;
            color: var(--text-primary);
            padding: 0;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
        }
        
        .modal-close:hover {
            background: var(--settings-bg);
            transform: rotate(90deg);
        }
        
        .favorite-item {
            background: var(--settings-bg);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }
        
        .favorite-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 15px var(--shadow);
        }
        
        .favorite-info {
            flex: 1;
        }
        
        .favorite-ticker {
            font-size: 1.5em;
            font-weight: bold;
            color: var(--text-primary);
        }
        
        .favorite-meta {
            color: var(--text-secondary);
            font-size: 0.9em;
            margin-top: 5px;
        }
        
        .favorite-actions {
            display: flex;
            gap: 10px;
        }
        
        .favorite-scan-btn, .favorite-remove-btn {
            padding: 8px 16px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .favorite-scan-btn {
            background: #10b981;
            color: white;
        }
        
        .favorite-scan-btn:hover {
            background: #059669;
            transform: scale(1.05);
        }
        
        .favorite-remove-btn {
            background: #ef4444;
            color: white;
        }
        
        .favorite-remove-btn:hover {
            background: #dc2626;
            transform: scale(1.05);
        }
        
        /* Win Rate Badge */
        .win-rate-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.9em;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .win-rate-high {
            background: #10b981;
            color: white;
        }
        
        .win-rate-medium {
            background: #FFA500;
            color: white;
        }
        
        .win-rate-low {
            background: #ef4444;
            color: white;
        }
        
        .win-rate-new {
            background: #666;
            color: white;
        }
        
        .disclaimer {
            background: #FF6B6B;
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-top: 30px;
            text-align: center;
            line-height: 1.6;
        }
        
        [data-theme="dark"] .disclaimer {
            background: #991b1b;
            color: #fee2e2;
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }
            
            .header::before, .header::after {
                display: none;
            }
            
            /* Hide toolbar on mobile */
            .toolbar {
                display: none;
            }
            
            /* Show floating buttons on mobile */
            .floating-actions {
                display: flex;
                position: fixed;
                bottom: 20px;
                right: 20px;
                flex-direction: column;
                gap: 12px;
                z-index: 1000;
            }
            
            .floating-actions .dark-mode-toggle {
                border-radius: 50%;
                width: 56px;
                height: 56px;
                padding: 0;
                font-size: 1.4em;
                box-shadow: 0 4px 20px var(--shadow-heavy);
            }
            
            .floating-actions .dark-mode-toggle:hover {
                transform: scale(1.1) rotate(10deg);
            }
            
            .floating-actions .dark-mode-toggle #darkModeText {
                display: none;
            }
            
            .floating-actions .favorites-toggle {
                border-radius: 50%;
                width: 56px;
                height: 56px;
                padding: 0;
                font-size: 1.6em;
                position: relative;
                box-shadow: 0 4px 20px rgba(255, 165, 0, 0.5);
            }
            
            .floating-actions .favorites-toggle:hover {
                transform: scale(1.1);
            }
            
            .floating-actions .favorites-toggle > span:not(.favorites-count) {
                display: none;
            }
            
            .floating-actions .favorites-toggle::before {
                content: '‚≠ê';
                font-size: 1em;
            }
            
            .floating-actions .favorites-count {
                position: absolute;
                top: -5px;
                right: -5px;
                background: #ef4444;
                border: 2px solid white;
                width: 22px;
                height: 22px;
                font-size: 0.7em;
            }
            
            .scan-button {
                padding: 20px 40px;
                font-size: 20px;
            }
            
            .stock-ticker {
                font-size: 1.5em;
            }
            
            .tab-button {
                font-size: 0.9em;
                padding: 15px 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üçã Lemon Squeeze v2.0</h1>
            <p>Multi-Timeframe Scanner: Stocks & Crypto</p>
            <span class="badge">v2.0 - Hourly ‚Ä¢ Daily ‚Ä¢ Weekly ‚Ä¢ Crypto</span>
        </div>
        
        <!-- Toolbar with actions -->
        <div class="toolbar">
            <button class="favorites-toggle" onclick="toggleFavoritesModal()">
                <span>‚≠ê</span>
                <span>Favorites</span>
                <span class="favorites-count" id="favoritesCount">0</span>
            </button>
            <button class="dark-mode-toggle" onclick="toggleDarkMode()" id="darkModeToggle">
                <span id="darkModeIcon">üåô</span>
                <span id="darkModeText">Dark</span>
            </button>
        </div>
        
        <!-- Tab Navigation -->
        <div class="tabs">
            <button class="tab-button active" onclick="switchTab('squeeze')">
                üçã Short Squeeze
            </button>
            <button class="tab-button" onclick="switchTab('hourly')">
                ‚è∞ Hourly Plays
            </button>
            <button class="tab-button" onclick="switchTab('daily')">
                üìà Daily Plays
            </button>
            <button class="tab-button" onclick="switchTab('weekly')">
                üìä Weekly Plays
            </button>
            <button class="tab-button" onclick="switchTab('crypto')">
                ‚Çø Crypto
            </button>
        </div>
        
        <!-- Short Squeeze Tab -->
        <div id="squeezeTab" class="tab-content active">
            <div class="content">
                <div class="settings-panel">
                    <h2>‚öôÔ∏è Scan Settings</h2>
                    <div class="settings-grid">
                        <div class="setting-item">
                            <label for="minShort">Min Short Interest %</label>
                            <input type="number" id="minShort" value="25" step="1" min="0">
                        </div>
                        <div class="setting-item">
                            <label for="minGain">Min Daily Gain %</label>
                            <input type="number" id="minGain" value="15" step="1" min="0">
                        </div>
                        <div class="setting-item">
                            <label for="minVolRatio">Min Volume Ratio</label>
                            <input type="number" id="minVolRatio" value="1.5" step="0.1" min="0">
                        </div>
                        <div class="setting-item">
                            <label for="minRisk">Min Risk Score</label>
                            <input type="number" id="minRisk" value="60" step="1" min="0" max="100">
                        </div>
                    </div>
                </div>
                
                <div class="scan-section">
                    <button id="scanButton" class="scan-button" onclick="startSqueezeScan()">
                        üîç SCAN FOR SQUEEZES üçã
                    </button>
                </div>
                
                <div id="squeezeLoading" class="loading">
                    <div class="spinner"></div>
                    <div class="loading-text">Squeezing lemons... üçã</div>
                </div>
                
                <div id="squeezeResults" class="results"></div>
                
                <div class="disclaimer">
                    <strong>‚ö†Ô∏è IMPORTANT DISCLAIMER</strong>
                    This tool is for informational and educational purposes only. Short squeezes are extremely high-risk and volatile. 
                    Past performance does not guarantee future results. Always conduct your own research (DYOR) and never invest more 
                    than you can afford to lose. This is NOT financial advice!
                </div>
            </div>
        </div>
        
        <!-- Hourly Plays Tab -->
        <div id="hourlyTab" class="tab-content">
            <div class="content">
                <div class="settings-panel">
                    <h2>üìö The 3-1 Strat Pattern (Hourly Timeframe)</h2>
                    <div style="background: #FFE97F; padding: 20px; border-radius: 10px;">
                        <ul style="margin-top: 10px; margin-left: 20px; line-height: 1.8; font-size: 1.1em;">
                            <li><strong>"3" = Outside Bar:</strong> Higher high + lower low than previous hour (expansion)</li>
                            <li><strong>"1" = Inside Bar:</strong> Lower high + higher low than previous hour (consolidation)</li>
                            <li><strong>Setup:</strong> Hourly patterns signal potential intraday moves</li>
                        </ul>
                        <p style="margin-top: 15px; padding: 10px; background: white; border-radius: 5px; font-style: italic;">
                            ‚è∞ Hourly scans are perfect for day trading - catch quick moves!
                        </p>
                    </div>
                </div>
                
                <div class="scan-section">
                    <button id="hourlyButton" class="scan-button" onclick="startHourlyScan()">
                        ‚è∞ SCAN HOURLY PATTERNS üéØ
                    </button>
                </div>
                
                <div id="hourlyLoading" class="loading">
                    <div class="spinner"></div>
                    <div class="loading-text">Squeezing hourly lemons... üçã‚è∞</div>
                </div>
                
                <div id="hourlyResults" class="results"></div>
                
                <div class="disclaimer">
                    <strong>‚ö†Ô∏è IMPORTANT DISCLAIMER</strong>
                    Hourly patterns are for active traders. Intraday moves can be volatile and unpredictable.
                    Always use proper risk management, set stop losses, and never risk more than you can afford to lose. This is NOT financial advice!
                </div>
            </div>
        </div>
        
        <!-- Daily Plays Tab -->
        <div id="dailyTab" class="tab-content">
            <div class="content">
                <div class="settings-panel">
                    <h2>üìö The 3-1 Strat Pattern</h2>
                    <div style="background: #FFE97F; padding: 20px; border-radius: 10px;">
                        <ul style="margin-top: 10px; margin-left: 20px; line-height: 1.8; font-size: 1.1em;">
                            <li><strong>"3" = Outside Bar:</strong> Higher high + lower low than previous candle (expansion)</li>
                            <li><strong>"1" = Inside Bar:</strong> Lower high + higher low than previous candle (consolidation)</li>
                            <li><strong>Setup:</strong> When a "1" follows a "3", it signals consolidation before a potential breakout</li>
                        </ul>
                        <p style="margin-top: 15px; padding: 10px; background: white; border-radius: 5px; font-style: italic;">
                            üí° This scanner checks 100+ popular stocks + high short interest stocks for this pattern
                        </p>
                    </div>
                </div>
                
                <div class="scan-section">
                    <button id="dailyButton" class="scan-button" onclick="startDailyScan()">
                        üìà SCAN ALL PATTERNS üéØ
                    </button>
                </div>
                
                <div id="dailyLoading" class="loading">
                    <div class="spinner"></div>
                    <div class="loading-text">Squeezing 3 lemons a day... üçãüçãüçã</div>
                </div>
                
                <div id="dailyResults" class="results"></div>
                
                <div class="disclaimer">
                    <strong>‚ö†Ô∏è IMPORTANT DISCLAIMER</strong>
                    Technical patterns are educational tools, not guarantees. Markets are unpredictable and pattern failures are common.
                    Always use proper risk management, set stop losses, and never risk more than you can afford to lose. This is NOT financial advice!
                </div>
            </div>
        </div>
        
        <!-- Weekly Plays Tab -->
        <div id="weeklyTab" class="tab-content">
            <div class="content">
                <div class="settings-panel">
                    <h2>üìö The 3-1 Strat Pattern (Weekly Timeframe)</h2>
                    <div style="background: #FFE97F; padding: 20px; border-radius: 10px;">
                        <ul style="margin-top: 10px; margin-left: 20px; line-height: 1.8; font-size: 1.1em;">
                            <li><strong>"3" = Outside Bar:</strong> Higher high + lower low than previous week (expansion)</li>
                            <li><strong>"1" = Inside Bar:</strong> Lower high + higher low than previous week (consolidation)</li>
                            <li><strong>Setup:</strong> Weekly patterns signal potential multi-day/week moves</li>
                        </ul>
                        <p style="margin-top: 15px; padding: 10px; background: white; border-radius: 5px; font-style: italic;">
                            üí° Weekly scans look for larger timeframe setups - these can signal bigger moves!
                        </p>
                    </div>
                </div>
                
                <div class="scan-section">
                    <button id="weeklyButton" class="scan-button" onclick="startWeeklyScan()">
                        üìä SCAN WEEKLY PATTERNS üéØ
                    </button>
                </div>
                
                <div id="weeklyLoading" class="loading">
                    <div class="spinner"></div>
                    <div class="loading-text">Squeezing weekly lemons... üçãüìä</div>
                </div>
                
                <div id="weeklyResults" class="results"></div>
                
                <div class="disclaimer">
                    <strong>‚ö†Ô∏è IMPORTANT DISCLAIMER</strong>
                    Technical patterns are educational tools, not guarantees. Weekly patterns suggest larger moves but markets are unpredictable.
                    Always use proper risk management, set stop losses, and never risk more than you can afford to lose. This is NOT financial advice!
                </div>
            </div>
        </div>
        
        <!-- Crypto Tab -->
        <div id="cryptoTab" class="tab-content">
            <div class="content">
                <div class="settings-panel">
                    <h2>‚Çø Crypto 3-1 Strat Scanner</h2>
                    <div style="background: #FFE97F; padding: 20px; border-radius: 10px;">
                        <p style="font-size: 1.1em; margin-bottom: 15px;"><strong>Scanning:</strong> BTC, ETH, XRP, SOL, DOGE, HYPE</p>
                        <ul style="margin-left: 20px; line-height: 1.8; font-size: 1.1em;">
                            <li><strong>Multi-Timeframe:</strong> Checks hourly, daily, AND weekly patterns</li>
                            <li><strong>Crypto-Specific:</strong> 24/7 markets with unique volatility</li>
                            <li><strong>Quick Signals:</strong> Find patterns across all major cryptos instantly</li>
                        </ul>
                        <p style="margin-top: 15px; padding: 10px; background: white; border-radius: 5px; font-style: italic;">
                            ‚Çø Crypto patterns can signal explosive moves - trade with caution!
                        </p>
                    </div>
                </div>
                
                <div class="scan-section">
                    <button id="cryptoButton" class="scan-button" onclick="startCryptoScan()">
                        ‚Çø SCAN CRYPTO PATTERNS üöÄ
                    </button>
                </div>
                
                <div id="cryptoLoading" class="loading">
                    <div class="spinner"></div>
                    <div class="loading-text">Squeezing crypto lemons... üçã‚Çø</div>
                </div>
                
                <div id="cryptoResults" class="results"></div>
                
                <div class="disclaimer">
                    <strong>‚ö†Ô∏è IMPORTANT DISCLAIMER</strong>
                    Cryptocurrency trading is extremely high-risk and volatile. Prices can swing dramatically in minutes.
                    Never invest more than you can afford to lose. This is NOT financial advice!
                </div>
            </div>
        </div>
    </div>
    
    <!-- Floating Actions (Mobile Only) -->
    <div class="floating-actions">
        <button class="favorites-toggle" onclick="toggleFavoritesModal()">
            <span>‚≠ê</span>
            <span>Favorites</span>
            <span class="favorites-count" id="favoritesCountMobile">0</span>
        </button>
        <button class="dark-mode-toggle" onclick="toggleDarkMode()">
            <span id="darkModeIconMobile">üåô</span>
            <span id="darkModeTextMobile">Dark</span>
        </button>
    </div>
    
    <!-- Favorites Modal -->
    <div id="favoritesModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚≠ê My Favorites</h2>
                <button class="modal-close" onclick="toggleFavoritesModal()">√ó</button>
            </div>
            <div id="favoritesList">
                <p style="text-align: center; color: var(--text-secondary); padding: 40px;">
                    No favorites yet! Click the ‚≠ê button on any stock to add it.
                </p>
            </div>
        </div>
    </div>
    
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
    <script>
        let isScanning = false;
        
        // ===== DARK MODE =====
        function toggleDarkMode() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            
            // Update both desktop and mobile buttons
            const icons = [document.getElementById('darkModeIcon'), document.getElementById('darkModeIconMobile')];
            const texts = [document.getElementById('darkModeText'), document.getElementById('darkModeTextMobile')];
            
            icons.forEach(icon => {
                if (icon) {
                    icon.textContent = newTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
                }
            });
            
            texts.forEach(text => {
                if (text) {
                    text.textContent = newTheme === 'dark' ? 'Light' : 'Dark';
                }
            });
        }
        
        // Load saved theme on page load
        document.addEventListener('DOMContentLoaded', function() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            
            if (savedTheme === 'dark') {
                const icons = [document.getElementById('darkModeIcon'), document.getElementById('darkModeIconMobile')];
                const texts = [document.getElementById('darkModeText'), document.getElementById('darkModeTextMobile')];
                
                icons.forEach(icon => {
                    if (icon) icon.textContent = '‚òÄÔ∏è';
                });
                
                texts.forEach(text => {
                    if (text) text.textContent = 'Light';
                });
            }
            
            updateFavoritesCount();
            loadHistoricalData();
        });
        
        // ===== FAVORITES SYSTEM =====
        function getFavorites() {
            const favorites = localStorage.getItem('lemonFavorites');
            return favorites ? JSON.parse(favorites) : [];
        }
        
        function saveFavorites(favorites) {
            localStorage.setItem('lemonFavorites', JSON.stringify(favorites));
            updateFavoritesCount();
        }
        
        function addToFavorites(ticker, company, timeframe = 'daily') {
            const favorites = getFavorites();
            const exists = favorites.find(f => f.ticker === ticker && f.timeframe === timeframe);
            
            if (!exists) {
                favorites.push({
                    ticker,
                    company,
                    timeframe,
                    addedAt: new Date().toISOString()
                });
                saveFavorites(favorites);
                alert(`‚úÖ ${ticker} added to favorites!`);
            } else {
                alert(`‚ÑπÔ∏è ${ticker} is already in favorites`);
            }
        }
        
        function removeFromFavorites(ticker, timeframe) {
            let favorites = getFavorites();
            favorites = favorites.filter(f => !(f.ticker === ticker && f.timeframe === timeframe));
            saveFavorites(favorites);
            displayFavorites();
        }
        
        function updateFavoritesCount() {
            const count = getFavorites().length;
            // Update both desktop and mobile counters
            const desktopCounter = document.getElementById('favoritesCount');
            const mobileCounter = document.getElementById('favoritesCountMobile');
            
            if (desktopCounter) desktopCounter.textContent = count;
            if (mobileCounter) mobileCounter.textContent = count;
        }
        
        function toggleFavoritesModal() {
            const modal = document.getElementById('favoritesModal');
            const isActive = modal.classList.contains('active');
            
            if (isActive) {
                modal.classList.remove('active');
            } else {
                modal.classList.add('active');
                displayFavorites();
            }
        }
        
        function displayFavorites() {
            const favorites = getFavorites();
            const container = document.getElementById('favoritesList');
            
            if (favorites.length === 0) {
                container.innerHTML = `
                    <p style="text-align: center; color: var(--text-secondary); padding: 40px;">
                        No favorites yet! Click the ‚≠ê button on any stock to add it.
                    </p>
                `;
                return;
            }
            
            let html = '';
            favorites.forEach(fav => {
                const winRate = getWinRate(fav.ticker, fav.timeframe);
                html += `
                    <div class="favorite-item">
                        <div class="favorite-info">
                            <div class="favorite-ticker">
                                ${fav.ticker}
                                ${winRate.badge}
                            </div>
                            <div class="favorite-meta">
                                ${fav.company} ‚Ä¢ ${fav.timeframe} ‚Ä¢ Added ${new Date(fav.addedAt).toLocaleDateString()}
                            </div>
                        </div>
                        <div class="favorite-actions">
                            <button class="favorite-scan-btn" onclick="scanFavorite('${fav.ticker}', '${fav.timeframe}')">
                                üîç Scan
                            </button>
                            <button class="favorite-remove-btn" onclick="removeFromFavorites('${fav.ticker}', '${fav.timeframe}')">
                                üóëÔ∏è
                            </button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function scanFavorite(ticker, timeframe) {
            // Close modal and switch to appropriate tab
            toggleFavoritesModal();
            
            // Switch to the right tab
            if (timeframe === 'hourly') {
                switchTab('hourly');
                startHourlyScan();
            } else if (timeframe === 'daily') {
                switchTab('daily');
                startDailyScan();
            } else if (timeframe === 'weekly') {
                switchTab('weekly');
                startWeeklyScan();
            } else if (timeframe === 'crypto') {
                switchTab('crypto');
                startCryptoScan();
            }
        }
        
        // ===== HISTORICAL WIN RATE TRACKING =====
        function getHistoricalData() {
            const data = localStorage.getItem('lemonHistorical');
            return data ? JSON.parse(data) : [];
        }
        
        function saveHistoricalData(data) {
            localStorage.setItem('lemonHistorical', JSON.stringify(data));
        }
        
        function trackPattern(ticker, timeframe, direction, currentPrice, patternDate) {
            const historical = getHistoricalData();
            
            historical.push({
                ticker,
                timeframe,
                direction,
                entryPrice: currentPrice,
                patternDate: patternDate,
                recordedAt: new Date().toISOString(),
                outcome: 'pending'
            });
            
            saveHistoricalData(historical);
        }
        
        async function loadHistoricalData() {
            // Check patterns after 7 days to see if they were successful
            const historical = getHistoricalData();
            const now = new Date();
            
            for (let pattern of historical) {
                if (pattern.outcome === 'pending') {
                    const recordedDate = new Date(pattern.recordedAt);
                    const daysSince = (now - recordedDate) / (1000 * 60 * 60 * 24);
                    
                    // Check after 7 days
                    if (daysSince >= 7) {
                        try {
                            const ticker = pattern.ticker.includes('-') ? pattern.ticker : pattern.ticker;
                            const stock = yf.Ticker(ticker);
                            const hist = await fetch(`https://query1.finance.yahoo.com/v8/finance/chart/${ticker}?interval=1d&range=1mo`);
                            const data = await hist.json();
                            
                            if (data && data.chart && data.chart.result[0]) {
                                const prices = data.chart.result[0].indicators.quote[0].close;
                                const currentPrice = prices[prices.length - 1];
                                const priceChange = ((currentPrice - pattern.entryPrice) / pattern.entryPrice) * 100;
                                
                                // Consider it a win if:
                                // - Bullish pattern and price went up 3%+
                                // - Bearish pattern and price went down 3%+
                                if (pattern.direction === 'bullish' && priceChange >= 3) {
                                    pattern.outcome = 'win';
                                    pattern.exitPrice = currentPrice;
                                    pattern.profitPercent = priceChange;
                                } else if (pattern.direction === 'bearish' && priceChange <= -3) {
                                    pattern.outcome = 'win';
                                    pattern.exitPrice = currentPrice;
                                    pattern.profitPercent = Math.abs(priceChange);
                                } else if (Math.abs(priceChange) < 3) {
                                    pattern.outcome = 'neutral';
                                } else {
                                    pattern.outcome = 'loss';
                                    pattern.exitPrice = currentPrice;
                                    pattern.profitPercent = priceChange;
                                }
                            }
                        } catch (e) {
                            console.error(`Error checking ${pattern.ticker}:`, e);
                        }
                    }
                }
            }
            
            saveHistoricalData(historical);
        }
        
        function getWinRate(ticker, timeframe) {
            const historical = getHistoricalData();
            const patterns = historical.filter(p => 
                p.ticker === ticker && 
                p.timeframe === timeframe &&
                p.outcome !== 'pending'
            );
            
            if (patterns.length === 0) {
                return {
                    rate: null,
                    badge: '<span class="win-rate-badge win-rate-new">NEW</span>'
                };
            }
            
            const wins = patterns.filter(p => p.outcome === 'win').length;
            const rate = (wins / patterns.length * 100).toFixed(0);
            
            let badgeClass = 'win-rate-medium';
            if (rate >= 70) badgeClass = 'win-rate-high';
            else if (rate < 50) badgeClass = 'win-rate-low';
            
            return {
                rate: rate,
                badge: `<span class="win-rate-badge ${badgeClass}">${rate}% Win (${wins}/${patterns.length})</span>`
            };
        }
        
        // ===== CHART INTEGRATION =====
        function createChart(containerId, ticker, timeframe = 'daily') {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            // Map timeframe to TradingView interval
            const intervalMap = {
                'hourly': '60',
                'daily': 'D',
                'weekly': 'W',
                'crypto': 'D'
            };
            
            const interval = intervalMap[timeframe] || 'D';
            const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'light';
            
            // For crypto, use the format expected by TradingView
            const symbol = ticker.includes('-USD') ? `CRYPTO:${ticker.replace('-USD', 'USD')}` : ticker;
            
            container.innerHTML = `
                <iframe 
                    src="https://s.tradingview.com/widgetembed/?frameElementId=tradingview_chart&symbol=${symbol}&interval=${interval}&hidesidetoolbar=0&symboledit=1&saveimage=1&toolbarbg=f1f3f6&studies=[]&theme=${theme}&style=1&timezone=Etc%2FUTC&withdateranges=1&showpopupbutton=1&studies_overrides={}&overrides={}&enabled_features=[]&disabled_features=[]&showpopupbutton=1&popup_height=650&popup_width=1000&locale=en"
                    style="width: 100%; height: 100%; margin: 0; padding: 0; border: none;"
                    frameborder="0"
                    allowtransparency="true"
                    scrolling="no"
                ></iframe>
            `;
        }
        
        // Tab switching
        function switchTab(tab) {
            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            if (tab === 'squeeze') {
                document.getElementById('squeezeTab').classList.add('active');
            } else if (tab === 'hourly') {
                document.getElementById('hourlyTab').classList.add('active');
            } else if (tab === 'daily') {
                document.getElementById('dailyTab').classList.add('active');
            } else if (tab === 'weekly') {
                document.getElementById('weeklyTab').classList.add('active');
            } else if (tab === 'crypto') {
                document.getElementById('cryptoTab').classList.add('active');
            }
        }
        
        // Short Squeeze Scanner
        async function startSqueezeScan() {
            if (isScanning) return;
            
            const minShort = parseFloat(document.getElementById('minShort').value);
            const minGain = parseFloat(document.getElementById('minGain').value);
            const minVolRatio = parseFloat(document.getElementById('minVolRatio').value);
            const minRisk = parseFloat(document.getElementById('minRisk').value);
            
            if (isNaN(minShort) || isNaN(minGain) || isNaN(minVolRatio) || isNaN(minRisk)) {
                alert('Please enter valid numbers!');
                return;
            }
            
            isScanning = true;
            document.getElementById('scanButton').disabled = true;
            document.getElementById('scanButton').textContent = '‚è≥ SCANNING...';
            document.getElementById('squeezeLoading').classList.add('active');
            document.getElementById('squeezeResults').classList.remove('active');
            
            try {
                const response = await fetch('/api/scan', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        minShort,
                        minGain,
                        minVolRatio,
                        minRisk
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    displaySqueezeResults(data.results, minShort, minGain, minVolRatio, minRisk);
                } else {
                    alert('Error: ' + data.error);
                }
                
            } catch (error) {
                alert('Error scanning: ' + error.message);
            } finally {
                isScanning = false;
                document.getElementById('scanButton').disabled = false;
                document.getElementById('scanButton').textContent = 'üîç SCAN FOR SQUEEZES üçã';
                document.getElementById('squeezeLoading').classList.remove('active');
            }
        }
        
        function displaySqueezeResults(candidates, minShort, minGain, minVolRatio, minRisk) {
            const resultsDiv = document.getElementById('squeezeResults');
            resultsDiv.classList.add('active');
            
            if (candidates.length === 0) {
                resultsDiv.innerHTML = `
                    <div class="no-results">
                        <h3>üçã No Squeezes Found Today</h3>
                        <p style="font-size: 1.2em; color: #666; margin: 20px 0;">
                            No stocks met the criteria: Short Interest ‚â•${minShort}% AND Daily Gain ‚â•+${minGain}%
                        </p>
                        <p style="color: #999;">
                            üí° Try lowering the thresholds or check back later!<br>
                            The market might just be having a calm day.
                        </p>
                    </div>
                `;
                return;
            }
            
            const avgGain = candidates.reduce((sum, s) => sum + s.dailyChange, 0) / candidates.length;
            const maxGain = Math.max(...candidates.map(s => s.dailyChange));
            const avgShort = candidates.reduce((sum, s) => sum + s.shortInterest, 0) / candidates.length;
            const avgRisk = candidates.reduce((sum, s) => sum + s.riskScore, 0) / candidates.length;
            
            let html = `
                <div class="results-header">
                    <h2>üöÄ Squeeze Candidates Found!</h2>
                    <p style="font-size: 1.2em; color: #666; margin: 10px 0;">
                        ${new Date().toLocaleString()}
                    </p>
                    <div class="summary-stats">
                        <div class="stat">
                            <span class="stat-value">${candidates.length}</span>
                            <span class="stat-label">Candidates</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value">${avgRisk.toFixed(1)}</span>
                            <span class="stat-label">Avg Risk Score</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value">+${avgGain.toFixed(2)}%</span>
                            <span class="stat-label">Avg Gain</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value">+${maxGain.toFixed(2)}%</span>
                            <span class="stat-label">Max Gain</span>
                        </div>
                    </div>
                </div>
            `;
            
            candidates.forEach((stock, idx) => {
                let riskClass, riskLabel, riskEmoji;
                if (stock.riskScore >= 90) {
                    riskClass = 'risk-extreme';
                    riskLabel = 'EXTREME';
                    riskEmoji = 'üî•üî•üî•';
                } else if (stock.riskScore >= 80) {
                    riskClass = 'risk-high';
                    riskLabel = 'HIGH';
                    riskEmoji = 'üöÄüöÄ';
                } else if (stock.riskScore >= 70) {
                    riskClass = 'risk-good';
                    riskLabel = 'GOOD';
                    riskEmoji = 'üí™';
                } else {
                    riskClass = 'risk-moderate';
                    riskLabel = 'MODERATE';
                    riskEmoji = '‚úÖ';
                }
                
                html += `
                    <div class="stock-card">
                        <div class="stock-header">
                            <div class="stock-title-row">
                                <button class="favorite-btn" onclick="addToFavorites('${stock.ticker}', '${stock.company}', 'squeeze')" title="Add to favorites">
                                    ‚≠ê
                                </button>
                                <div class="stock-ticker">#${idx + 1}. ${stock.ticker}</div>
                            </div>
                            <div class="risk-badge ${riskClass}">
                                ${stock.riskScore}/100 ${riskEmoji}
                            </div>
                        </div>
                        <div class="stock-company">${stock.company}</div>
                        
                        <div class="metrics-grid">
                            <div class="metric-section">
                                <h4>üìä Core Metrics</h4>
                                <div class="metric-item">
                                    <span class="metric-label">Short Interest:</span>
                                    <span class="metric-value">${stock.shortInterest.toFixed(2)}%</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Daily Gain:</span>
                                    <span class="metric-value" style="color: #10b981;">+${stock.dailyChange.toFixed(2)}%</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Price Move:</span>
                                    <span class="metric-value">$${stock.previousClose.toFixed(2)} ‚Üí $${stock.currentPrice.toFixed(2)}</span>
                                </div>
                            </div>
                            
                            <div class="metric-section">
                                <h4>üìà Volume Analysis</h4>
                                <div class="metric-item">
                                    <span class="metric-label">Current Vol:</span>
                                    <span class="metric-value">${stock.volume.toLocaleString()}</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Avg Volume:</span>
                                    <span class="metric-value">${stock.avgVolume.toLocaleString()}</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Volume Ratio:</span>
                                    <span class="metric-value">${stock.volumeRatio.toFixed(2)}x ${stock.volumeRatio >= 3 ? 'üî•' : stock.volumeRatio >= 2 ? 'üöÄ' : '‚úÖ'}</span>
                                </div>
                            </div>
                            
                            <div class="metric-section">
                                <h4>‚öôÔ∏è Squeeze Mechanics</h4>
                                <div class="metric-item">
                                    <span class="metric-label">Float:</span>
                                    <span class="metric-value">${(stock.floatShares / 1000000).toFixed(1)}M</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Days to Cover:</span>
                                    <span class="metric-value">${stock.daysToCover.toFixed(2)} ${stock.daysToCover >= 5 ? 'üöÄ' : '‚úÖ'}</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Market Cap:</span>
                                    <span class="metric-value">$${(stock.marketCap / 1000000).toFixed(1)}M</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="chart-container" id="chart-${stock.ticker}-squeeze-${idx}"></div>
                    </div>
                `;
            });
            
            resultsDiv.innerHTML = html;
            
            // Create charts after HTML is rendered
            candidates.forEach((stock, idx) => {
                setTimeout(() => createChart(`chart-${stock.ticker}-squeeze-${idx}`, stock.ticker, 'daily'), 200 + (idx * 100));
            });
        }
        
        // Daily Plays Scanner
        async function startDailyScan() {
            if (isScanning) return;
            
            isScanning = true;
            document.getElementById('dailyButton').disabled = true;
            document.getElementById('dailyButton').textContent = '‚è≥ SCANNING...';
            document.getElementById('dailyLoading').classList.add('active');
            document.getElementById('dailyResults').classList.remove('active');
            
            try {
                const response = await fetch('/api/daily-plays', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({})  // No filters needed
                });
                
                const data = await response.json();
                
                if (data.success) {
                    displayDailyResults(data.results);
                } else {
                    alert('Error: ' + data.error);
                }
                
            } catch (error) {
                alert('Error scanning: ' + error.message);
                console.error('Scan error:', error);
            } finally {
                isScanning = false;
                document.getElementById('dailyButton').disabled = false;
                document.getElementById('dailyButton').textContent = 'üìà SCAN ALL PATTERNS üéØ';
                document.getElementById('dailyLoading').classList.remove('active');
            }
        }
        
        function displayDailyResults(patterns) {
            const resultsDiv = document.getElementById('dailyResults');
            resultsDiv.classList.add('active');
            
            if (patterns.length === 0) {
                resultsDiv.innerHTML = `
                    <div class="no-results">
                        <h3>üéØ No Patterns Found Today</h3>
                        <p style="font-size: 1.2em; color: #666; margin: 20px 0;">
                            No stocks showed the 3-1 Strat pattern today
                        </p>
                        <p style="color: #999;">
                            üí° Market conditions may not be favorable right now.<br>
                            Check back later or try during market hours!
                        </p>
                    </div>
                `;
                return;
            }
            
            const bullishCount = patterns.filter(p => p.pattern.direction === 'bullish').length;
            const bearishCount = patterns.filter(p => p.pattern.direction === 'bearish').length;
            const totalVolume = patterns.reduce((sum, p) => sum + p.volume, 0);
            const avgVolume = totalVolume / patterns.length;
            
            let html = `
                <div class="results-header">
                    <h2>üéØ 3-1 Strat Patterns Found!</h2>
                    <p style="font-size: 1.2em; color: #666; margin: 10px 0;">
                        ${new Date().toLocaleString()}
                    </p>
                    <div class="summary-stats">
                        <div class="stat">
                            <span class="stat-value">${patterns.length}</span>
                            <span class="stat-label">Total Patterns</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value" style="color: #10b981;">${bullishCount}</span>
                            <span class="stat-label">Bullish</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value" style="color: #ef4444;">${bearishCount}</span>
                            <span class="stat-label">Bearish</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value">${(avgVolume / 1000000).toFixed(1)}M</span>
                            <span class="stat-label">Avg Volume</span>
                        </div>
                    </div>
                </div>
            `;
            
            patterns.forEach((stock, idx) => {
                const pattern = stock.pattern;
                const patternClass = pattern.direction === 'bullish' ? 'pattern-bullish' : 'pattern-bearish';
                const patternEmoji = pattern.direction === 'bullish' ? 'üìà' : 'üìâ';
                
                html += `
                    <div class="pattern-card">
                        <div class="stock-header">
                            <div class="stock-title-row">
                                <button class="favorite-btn" onclick="addToFavorites('${stock.ticker}', '${stock.company}', 'daily')" title="Add to favorites">
                                    ‚≠ê
                                </button>
                                <div class="stock-ticker">#${idx + 1}. ${stock.ticker}</div>
                            </div>
                            <div class="pattern-badge ${patternClass}">
                                ${patternEmoji} ${pattern.direction.toUpperCase()}
                            </div>
                        </div>
                        <div class="stock-company">${stock.company}</div>
                        
                        <div class="pattern-info">
                            <h4 style="color: #FFA500; margin-bottom: 10px;">üìä Pattern Details</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <strong style="color: #666;">3Ô∏è‚É£ Outside Bar (${pattern.three_candle.date}):</strong><br>
                                    High: $${pattern.three_candle.high.toFixed(2)}<br>
                                    Low: $${pattern.three_candle.low.toFixed(2)}<br>
                                    Close: $${pattern.three_candle.close.toFixed(2)}
                                </div>
                                <div>
                                    <strong style="color: #666;">1Ô∏è‚É£ Inside Bar (${pattern.one_candle.date}):</strong><br>
                                    High: $${pattern.one_candle.high.toFixed(2)}<br>
                                    Low: $${pattern.one_candle.low.toFixed(2)}<br>
                                    Open: $${pattern.one_candle.open.toFixed(2)}<br>
                                    Close: $${pattern.one_candle.close.toFixed(2)}
                                </div>
                            </div>
                            <div style="background: white; padding: 10px; border-radius: 5px; margin-top: 10px;">
                                <strong>üí° Interpretation:</strong> 
                                The stock formed an outside bar (expansion) followed by an inside bar (consolidation). 
                                This ${pattern.direction} setup suggests potential breakout ${pattern.direction === 'bullish' ? 'above' : 'below'} 
                                the inside bar's range.
                            </div>
                        </div>
                        
                        <div class="metrics-grid" style="margin-top: 20px;">
                            <div class="metric-section">
                                <h4>üí∞ Price Info</h4>
                                <div class="metric-item">
                                    <span class="metric-label">Current Price:</span>
                                    <span class="metric-value">$${stock.currentPrice.toFixed(2)}</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Daily Change:</span>
                                    <span class="metric-value" style="color: ${stock.dailyChange >= 0 ? '#10b981' : '#ef4444'};">
                                        ${stock.dailyChange >= 0 ? '+' : ''}${stock.dailyChange.toFixed(2)}%
                                    </span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Market Cap:</span>
                                    <span class="metric-value">$${(stock.marketCap / 1000000).toFixed(1)}M</span>
                                </div>
                            </div>
                            
                            <div class="metric-section">
                                <h4>üìä Volume Info</h4>
                                <div class="metric-item">
                                    <span class="metric-label">Current Vol:</span>
                                    <span class="metric-value">${stock.volume.toLocaleString()}</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Avg Volume:</span>
                                    <span class="metric-value">${stock.avgVolume.toLocaleString()}</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Volume Ratio:</span>
                                    <span class="metric-value">${(stock.volume / stock.avgVolume).toFixed(2)}x</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="chart-container" id="chart-${stock.ticker}-daily-${idx}"></div>
                    </div>
                `;
            });
            
            resultsDiv.innerHTML = html;
            
            // Create charts after HTML is rendered
            patterns.forEach((stock, idx) => {
                setTimeout(() => createChart(`chart-${stock.ticker}-daily-${idx}`, stock.ticker, 'daily'), 200 + (idx * 100));
            });
        }
        
        // Weekly Plays Scanner
        async function startWeeklyScan() {
            if (isScanning) return;
            
            isScanning = true;
            document.getElementById('weeklyButton').disabled = true;
            document.getElementById('weeklyButton').textContent = '‚è≥ SCANNING...';
            document.getElementById('weeklyLoading').classList.add('active');
            document.getElementById('weeklyResults').classList.remove('active');
            
            try {
                const response = await fetch('/api/weekly-plays', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({})  // No filters needed
                });
                
                const data = await response.json();
                
                if (data.success) {
                    displayWeeklyResults(data.results);
                } else {
                    alert('Error: ' + data.error);
                }
                
            } catch (error) {
                alert('Error scanning: ' + error.message);
                console.error('Weekly scan error:', error);
            } finally {
                isScanning = false;
                document.getElementById('weeklyButton').disabled = false;
                document.getElementById('weeklyButton').textContent = 'üìä SCAN WEEKLY PATTERNS üéØ';
                document.getElementById('weeklyLoading').classList.remove('active');
            }
        }
        
        function displayWeeklyResults(patterns) {
            const resultsDiv = document.getElementById('weeklyResults');
            resultsDiv.classList.add('active');
            
            if (patterns.length === 0) {
                resultsDiv.innerHTML = `
                    <div class="no-results">
                        <h3>üéØ No Weekly Patterns Found</h3>
                        <p style="font-size: 1.2em; color: #666; margin: 20px 0;">
                            No stocks showed the 3-1 Strat pattern on weekly timeframe
                        </p>
                        <p style="color: #999;">
                            üí° Weekly patterns are less common but signal larger moves.<br>
                            Check back next week!
                        </p>
                    </div>
                `;
                return;
            }
            
            const bullishCount = patterns.filter(p => p.pattern.direction === 'bullish').length;
            const bearishCount = patterns.filter(p => p.pattern.direction === 'bearish').length;
            const totalVolume = patterns.reduce((sum, p) => sum + p.volume, 0);
            const avgVolume = totalVolume / patterns.length;
            
            let html = `
                <div class="results-header">
                    <h2>üìä Weekly 3-1 Strat Patterns Found!</h2>
                    <p style="font-size: 1.2em; color: #666; margin: 10px 0;">
                        ${new Date().toLocaleString()}
                    </p>
                    <div class="summary-stats">
                        <div class="stat">
                            <span class="stat-value">${patterns.length}</span>
                            <span class="stat-label">Total Patterns</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value" style="color: #10b981;">${bullishCount}</span>
                            <span class="stat-label">Bullish</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value" style="color: #ef4444;">${bearishCount}</span>
                            <span class="stat-label">Bearish</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value">${(avgVolume / 1000000).toFixed(1)}M</span>
                            <span class="stat-label">Avg Weekly Vol</span>
                        </div>
                    </div>
                </div>
            `;
            
            patterns.forEach((stock, idx) => {
                const pattern = stock.pattern;
                const patternClass = pattern.direction === 'bullish' ? 'pattern-bullish' : 'pattern-bearish';
                const patternEmoji = pattern.direction === 'bullish' ? 'üìà' : 'üìâ';
                
                html += `
                    <div class="pattern-card">
                        <div class="stock-header">
                            <div class="stock-title-row">
                                <button class="favorite-btn" onclick="addToFavorites('${stock.ticker}', '${stock.company}', 'weekly')" title="Add to favorites">
                                    ‚≠ê
                                </button>
                                <div class="stock-ticker">#${idx + 1}. ${stock.ticker}</div>
                            </div>
                            <div class="pattern-badge ${patternClass}">
                                ${patternEmoji} ${pattern.direction.toUpperCase()} (WEEKLY)
                            </div>
                        </div>
                        <div class="stock-company">${stock.company}</div>
                        
                        <div class="pattern-info">
                            <h4 style="color: #FFA500; margin-bottom: 10px;">üìä Weekly Pattern Details</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <strong style="color: #666;">3Ô∏è‚É£ Outside Week (${pattern.three_candle.date}):</strong><br>
                                    High: $${pattern.three_candle.high.toFixed(2)}<br>
                                    Low: $${pattern.three_candle.low.toFixed(2)}<br>
                                    Close: $${pattern.three_candle.close.toFixed(2)}
                                </div>
                                <div>
                                    <strong style="color: #666;">1Ô∏è‚É£ Inside Week (${pattern.one_candle.date}):</strong><br>
                                    High: $${pattern.one_candle.high.toFixed(2)}<br>
                                    Low: $${pattern.one_candle.low.toFixed(2)}<br>
                                    Open: $${pattern.one_candle.open.toFixed(2)}<br>
                                    Close: $${pattern.one_candle.close.toFixed(2)}
                                </div>
                            </div>
                            <div style="background: white; padding: 10px; border-radius: 5px; margin-top: 10px;">
                                <strong>üí° Interpretation:</strong> 
                                Weekly pattern! The stock formed an outside week (expansion) followed by an inside week (consolidation). 
                                This ${pattern.direction} setup on the weekly timeframe suggests potential for a multi-day/week move 
                                ${pattern.direction === 'bullish' ? 'above' : 'below'} the inside week's range.
                            </div>
                        </div>
                        
                        <div class="metrics-grid" style="margin-top: 20px;">
                            <div class="metric-section">
                                <h4>üí∞ Price Info</h4>
                                <div class="metric-item">
                                    <span class="metric-label">Current Price:</span>
                                    <span class="metric-value">$${stock.currentPrice.toFixed(2)}</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Weekly Change:</span>
                                    <span class="metric-value" style="color: ${stock.weeklyChange >= 0 ? '#10b981' : '#ef4444'};">
                                        ${stock.weeklyChange >= 0 ? '+' : ''}${stock.weeklyChange.toFixed(2)}%
                                    </span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Market Cap:</span>
                                    <span class="metric-value">$${(stock.marketCap / 1000000).toFixed(1)}M</span>
                                </div>
                            </div>
                            
                            <div class="metric-section">
                                <h4>üìä Volume Info</h4>
                                <div class="metric-item">
                                    <span class="metric-label">This Week Vol:</span>
                                    <span class="metric-value">${stock.volume.toLocaleString()}</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Avg Weekly Vol:</span>
                                    <span class="metric-value">${stock.avgVolume.toLocaleString()}</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Volume Ratio:</span>
                                    <span class="metric-value">${(stock.volume / stock.avgVolume).toFixed(2)}x</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="chart-container" id="chart-${stock.ticker}-weekly-${idx}"></div>
                    </div>
                `;
            });
            
            resultsDiv.innerHTML = html;
            
            // Create charts after HTML is rendered
            patterns.forEach((stock, idx) => {
                setTimeout(() => createChart(`chart-${stock.ticker}-weekly-${idx}`, stock.ticker, 'weekly'), 200 + (idx * 100));
            });
        }
        
        // Hourly Plays Scanner
        async function startHourlyScan() {
            if (isScanning) return;
            
            isScanning = true;
            document.getElementById('hourlyButton').disabled = true;
            document.getElementById('hourlyButton').textContent = '‚è≥ SCANNING...';
            document.getElementById('hourlyLoading').classList.add('active');
            document.getElementById('hourlyResults').classList.remove('active');
            
            try {
                const response = await fetch('/api/hourly-plays', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({})
                });
                
                const data = await response.json();
                
                if (data.success) {
                    displayHourlyResults(data.results);
                } else {
                    alert('Error: ' + data.error);
                }
                
            } catch (error) {
                alert('Error scanning: ' + error.message);
                console.error('Hourly scan error:', error);
            } finally {
                isScanning = false;
                document.getElementById('hourlyButton').disabled = false;
                document.getElementById('hourlyButton').textContent = '‚è∞ SCAN HOURLY PATTERNS üéØ';
                document.getElementById('hourlyLoading').classList.remove('active');
            }
        }
        
        function displayHourlyResults(patterns) {
            const resultsDiv = document.getElementById('hourlyResults');
            resultsDiv.classList.add('active');
            
            if (patterns.length === 0) {
                resultsDiv.innerHTML = `
                    <div class="no-results">
                        <h3>üéØ No Hourly Patterns Found</h3>
                        <p style="font-size: 1.2em; color: #666; margin: 20px 0;">
                            No stocks showed the 3-1 Strat pattern on hourly timeframe right now
                        </p>
                        <p style="color: #999;">
                            ‚è∞ Hourly patterns change frequently - try again in an hour!
                        </p>
                    </div>
                `;
                return;
            }
            
            const bullishCount = patterns.filter(p => p.pattern.direction === 'bullish').length;
            const bearishCount = patterns.filter(p => p.pattern.direction === 'bearish').length;
            
            let html = `
                <div class="results-header">
                    <h2>‚è∞ Hourly 3-1 Strat Patterns Found!</h2>
                    <p style="font-size: 1.2em; color: #666; margin: 10px 0;">
                        ${new Date().toLocaleString()}
                    </p>
                    <div class="summary-stats">
                        <div class="stat">
                            <span class="stat-value">${patterns.length}</span>
                            <span class="stat-label">Total Patterns</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value" style="color: #10b981;">${bullishCount}</span>
                            <span class="stat-label">Bullish</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value" style="color: #ef4444;">${bearishCount}</span>
                            <span class="stat-label">Bearish</span>
                        </div>
                    </div>
                </div>
            `;
            
            patterns.forEach((stock, idx) => {
                const pattern = stock.pattern;
                const patternClass = pattern.direction === 'bullish' ? 'pattern-bullish' : 'pattern-bearish';
                const patternEmoji = pattern.direction === 'bullish' ? 'üìà' : 'üìâ';
                
                html += `
                    <div class="pattern-card">
                        <div class="stock-header">
                            <div class="stock-title-row">
                                <button class="favorite-btn" onclick="addToFavorites('${stock.ticker}', '${stock.company}', 'hourly')" title="Add to favorites">
                                    ‚≠ê
                                </button>
                                <div class="stock-ticker">#${idx + 1}. ${stock.ticker}</div>
                            </div>
                            <div class="pattern-badge ${patternClass}">
                                ${patternEmoji} ${pattern.direction.toUpperCase()} (HOURLY)
                            </div>
                        </div>
                        <div class="stock-company">${stock.company}</div>
                        
                        <div class="pattern-info">
                            <h4 style="color: #FFA500; margin-bottom: 10px;">‚è∞ Hourly Pattern Details</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <strong style="color: #666;">3Ô∏è‚É£ Outside Hour (${pattern.three_candle.date}):</strong><br>
                                    High: $${pattern.three_candle.high.toFixed(2)}<br>
                                    Low: $${pattern.three_candle.low.toFixed(2)}<br>
                                    Close: $${pattern.three_candle.close.toFixed(2)}
                                </div>
                                <div>
                                    <strong style="color: #666;">1Ô∏è‚É£ Inside Hour (${pattern.one_candle.date}):</strong><br>
                                    High: $${pattern.one_candle.high.toFixed(2)}<br>
                                    Low: $${pattern.one_candle.low.toFixed(2)}<br>
                                    Open: $${pattern.one_candle.open.toFixed(2)}<br>
                                    Close: $${pattern.one_candle.close.toFixed(2)}
                                </div>
                            </div>
                            <div style="background: white; padding: 10px; border-radius: 5px; margin-top: 10px;">
                                <strong>üí° Interpretation:</strong> 
                                Hourly pattern! Quick intraday setup showing ${pattern.direction} consolidation after expansion.
                                Watch for breakout ${pattern.direction === 'bullish' ? 'above' : 'below'} the inside hour's range.
                            </div>
                        </div>
                        
                        <div class="metrics-grid" style="margin-top: 20px;">
                            <div class="metric-section">
                                <h4>üí∞ Price Info</h4>
                                <div class="metric-item">
                                    <span class="metric-label">Current Price:</span>
                                    <span class="metric-value">$${stock.currentPrice.toFixed(2)}</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Hourly Change:</span>
                                    <span class="metric-value" style="color: ${stock.hourlyChange >= 0 ? '#10b981' : '#ef4444'};">
                                        ${stock.hourlyChange >= 0 ? '+' : ''}${stock.hourlyChange.toFixed(2)}%
                                    </span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Market Cap:</span>
                                    <span class="metric-value">$${(stock.marketCap / 1000000).toFixed(1)}M</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="chart-container" id="chart-${stock.ticker}-hourly-${idx}"></div>
                    </div>
                `;
            });
            
            resultsDiv.innerHTML = html;
            
            // Create charts after HTML is rendered
            patterns.forEach((stock, idx) => {
                setTimeout(() => createChart(`chart-${stock.ticker}-hourly-${idx}`, stock.ticker, 'hourly'), 200 + (idx * 100));
            });
        }
        
        // Crypto Scanner
        async function startCryptoScan() {
            if (isScanning) return;
            
            isScanning = true;
            document.getElementById('cryptoButton').disabled = true;
            document.getElementById('cryptoButton').textContent = '‚è≥ SCANNING...';
            document.getElementById('cryptoLoading').classList.add('active');
            document.getElementById('cryptoResults').classList.remove('active');
            
            try {
                const response = await fetch('/api/crypto-plays', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({})
                });
                
                const data = await response.json();
                
                if (data.success) {
                    displayCryptoResults(data.results);
                } else {
                    alert('Error: ' + data.error);
                }
                
            } catch (error) {
                alert('Error scanning: ' + error.message);
                console.error('Crypto scan error:', error);
            } finally {
                isScanning = false;
                document.getElementById('cryptoButton').disabled = false;
                document.getElementById('cryptoButton').textContent = '‚Çø SCAN CRYPTO PATTERNS üöÄ';
                document.getElementById('cryptoLoading').classList.remove('active');
            }
        }
        
        function displayCryptoResults(patterns) {
            const resultsDiv = document.getElementById('cryptoResults');
            resultsDiv.classList.add('active');
            
            if (patterns.length === 0) {
                resultsDiv.innerHTML = `
                    <div class="no-results">
                        <h3>‚Çø No Crypto Patterns Found</h3>
                        <p style="font-size: 1.2em; color: #666; margin: 20px 0;">
                            No 3-1 Strat patterns found in BTC, ETH, XRP, SOL, DOGE, HYPE
                        </p>
                        <p style="color: #999;">
                            üí° Crypto patterns can form quickly - check back soon!
                        </p>
                    </div>
                `;
                return;
            }
            
            // Group by crypto
            const grouped = {};
            patterns.forEach(p => {
                if (!grouped[p.ticker]) grouped[p.ticker] = [];
                grouped[p.ticker].push(p);
            });
            
            let html = `
                <div class="results-header">
                    <h2>‚Çø Crypto 3-1 Strat Patterns Found!</h2>
                    <p style="font-size: 1.2em; color: #666; margin: 10px 0;">
                        ${new Date().toLocaleString()}
                    </p>
                    <div class="summary-stats">
                        <div class="stat">
                            <span class="stat-value">${patterns.length}</span>
                            <span class="stat-label">Total Patterns</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value">${Object.keys(grouped).length}</span>
                            <span class="stat-label">Cryptos</span>
                        </div>
                    </div>
                </div>
            `;
            
            patterns.forEach((crypto, idx) => {
                const pattern = crypto.pattern;
                const patternClass = pattern.direction === 'bullish' ? 'pattern-bullish' : 'pattern-bearish';
                const patternEmoji = pattern.direction === 'bullish' ? 'üìà' : 'üìâ';
                
                html += `
                    <div class="pattern-card">
                        <div class="stock-header">
                            <div class="stock-title-row">
                                <button class="favorite-btn" onclick="addToFavorites('${crypto.ticker}', '${crypto.company}', 'crypto')" title="Add to favorites">
                                    ‚≠ê
                                </button>
                                <div class="stock-ticker">#${idx + 1}. ${crypto.ticker}</div>
                            </div>
                            <div class="pattern-badge ${patternClass}">
                                ${patternEmoji} ${pattern.direction.toUpperCase()} (${crypto.timeframe.toUpperCase()})
                            </div>
                        </div>
                        <div class="stock-company">${crypto.company}</div>
                        
                        <div class="pattern-info">
                            <h4 style="color: #FFA500; margin-bottom: 10px;">‚Çø ${crypto.timeframe} Pattern Details</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <strong style="color: #666;">3Ô∏è‚É£ Outside Bar (${pattern.three_candle.date}):</strong><br>
                                    High: $${pattern.three_candle.high.toFixed(2)}<br>
                                    Low: $${pattern.three_candle.low.toFixed(2)}<br>
                                    Close: $${pattern.three_candle.close.toFixed(2)}
                                </div>
                                <div>
                                    <strong style="color: #666;">1Ô∏è‚É£ Inside Bar (${pattern.one_candle.date}):</strong><br>
                                    High: $${pattern.one_candle.high.toFixed(2)}<br>
                                    Low: $${pattern.one_candle.low.toFixed(2)}<br>
                                    Open: $${pattern.one_candle.open.toFixed(2)}<br>
                                    Close: $${pattern.one_candle.close.toFixed(2)}
                                </div>
                            </div>
                            <div style="background: white; padding: 10px; border-radius: 5px; margin-top: 10px;">
                                <strong>üí° Interpretation:</strong> 
                                ${crypto.timeframe} crypto pattern! ${pattern.direction.charAt(0).toUpperCase() + pattern.direction.slice(1)} setup 
                                suggests potential breakout ${pattern.direction === 'bullish' ? 'above' : 'below'} the consolidation range.
                                ${crypto.timeframe === 'Weekly' ? 'Weekly patterns can signal major multi-week moves!' : ''}
                            </div>
                        </div>
                        
                        <div class="metrics-grid" style="margin-top: 20px;">
                            <div class="metric-section">
                                <h4>üí∞ Price Info</h4>
                                <div class="metric-item">
                                    <span class="metric-label">Current Price:</span>
                                    <span class="metric-value">$${crypto.currentPrice.toFixed(2)}</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">${crypto.timeframe} Change:</span>
                                    <span class="metric-value" style="color: ${crypto.change >= 0 ? '#10b981' : '#ef4444'};">
                                        ${crypto.change >= 0 ? '+' : ''}${crypto.change.toFixed(2)}%
                                    </span>
                                </div>
                                ${crypto.marketCap > 0 ? `
                                <div class="metric-item">
                                    <span class="metric-label">Market Cap:</span>
                                    <span class="metric-value">$${(crypto.marketCap / 1000000000).toFixed(2)}B</span>
                                </div>
                                ` : ''}
                            </div>
                            
                            <div class="metric-section">
                                <h4>üìä Volume Info</h4>
                                <div class="metric-item">
                                    <span class="metric-label">Current Vol:</span>
                                    <span class="metric-value">${crypto.volume.toLocaleString()}</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Avg Volume:</span>
                                    <span class="metric-value">${crypto.avgVolume.toLocaleString()}</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="chart-container" id="chart-${crypto.ticker}-crypto-${idx}"></div>
                    </div>
                `;
            });
            
            resultsDiv.innerHTML = html;
            
            // Create charts after HTML is rendered
            patterns.forEach((crypto, idx) => {
                setTimeout(() => createChart(`chart-${crypto.ticker}-crypto-${idx}`, crypto.fullTicker, 'crypto'), 200 + (idx * 100));
            });
        }
    </script>
</body>
</html>
