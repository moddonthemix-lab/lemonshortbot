<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üçã Lemon Squeeze Web App v2.0</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1300px;
            margin: 0 auto;
            background: #FFF9E6;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: #333;
            padding: 40px;
            text-align: center;
            position: relative;
        }
        
        .header::before, .header::after {
            content: "üçã";
            position: absolute;
            font-size: 100px;
            opacity: 0.1;
            top: 20px;
        }
        
        .header::before { left: 50px; }
        .header::after { right: 50px; }
        
        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .header p {
            font-size: 1.3em;
            font-style: italic;
            opacity: 0.9;
        }
        
        .badge {
            display: inline-block;
            background: #FF6B6B;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-top: 10px;
            font-weight: bold;
        }
        
        /* Tab Navigation */
        .tabs {
            display: flex;
            justify-content: center;
            background: #FFE97F;
            padding: 0;
            margin: 0;
        }
        
        .tab-button {
            flex: 1;
            max-width: 300px;
            padding: 20px 30px;
            background: transparent;
            border: none;
            font-size: 1.3em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            color: #666;
            border-bottom: 4px solid transparent;
        }
        
        .tab-button:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .tab-button.active {
            background: #FFF9E6;
            color: #FFA500;
            border-bottom: 4px solid #FFA500;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .content {
            padding: 40px;
        }
        
        .settings-panel {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .settings-panel h2 {
            color: #FFA500;
            margin-bottom: 20px;
            font-size: 1.5em;
        }
        
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .setting-item {
            display: flex;
            flex-direction: column;
        }
        
        label {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            font-size: 1.1em;
        }
        
        input[type="number"] {
            padding: 12px;
            border: 3px solid #FFD700;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            transition: all 0.3s;
        }
        
        select {
            padding: 12px;
            border: 3px solid #FFD700;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            transition: all 0.3s;
            background: white;
            cursor: pointer;
        }
        
        input[type="number"]:focus, select:focus {
            outline: none;
            border-color: #FFA500;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
        }
        
        .scan-section {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .scan-button {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: #333;
            border: none;
            padding: 25px 60px;
            font-size: 28px;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 8px 25px rgba(255, 165, 0, 0.4);
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .scan-button:hover:not(:disabled) {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(255, 165, 0, 0.6);
        }
        
        .scan-button:active {
            transform: translateY(-2px);
        }
        
        .scan-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .loading.active {
            display: block;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #FFD700;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            font-size: 1.2em;
            color: #666;
            font-weight: 600;
        }
        
        .results {
            display: none;
        }
        
        .results.active {
            display: block;
        }
        
        .results-header {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .results-header h2 {
            color: #FFA500;
            font-size: 2em;
            margin-bottom: 15px;
        }
        
        .summary-stats {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }
        
        .stat {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #FFA500;
        }
        
        .stat-label {
            font-size: 1em;
            color: #666;
            margin-top: 5px;
        }
        
        .stock-card, .pattern-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .stock-card:hover, .pattern-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .stock-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .stock-ticker {
            font-size: 2em;
            font-weight: bold;
            color: #333;
        }
        
        .stock-company {
            font-size: 1.2em;
            color: #666;
            margin-bottom: 20px;
        }
        
        .risk-badge {
            padding: 12px 20px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 1.2em;
        }
        
        .risk-extreme {
            background: linear-gradient(135deg, #FF0000 0%, #CC0000 100%);
            color: white;
            animation: pulse 2s ease-in-out infinite;
        }
        
        .risk-high {
            background: linear-gradient(135deg, #FF6B6B 0%, #FF4444 100%);
            color: white;
        }
        
        .risk-good {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        
        .risk-moderate {
            background: linear-gradient(135deg, #FFA500 0%, #FF8C00 100%);
            color: white;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .metric-section {
            background: #FFF9E6;
            padding: 15px;
            border-radius: 10px;
        }
        
        .metric-section h4 {
            color: #FFA500;
            margin-bottom: 12px;
            font-size: 1.1em;
        }
        
        .metric-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #FFE97F;
        }
        
        .metric-item:last-child {
            border-bottom: none;
        }
        
        .metric-label {
            color: #666;
            font-weight: 600;
        }
        
        .metric-value {
            color: #333;
            font-weight: bold;
        }
        
        .pattern-info {
            background: #FFF9E6;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
        }
        
        .pattern-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            margin: 5px;
        }
        
        .pattern-bullish {
            background: #10b981;
            color: white;
        }
        
        .pattern-bearish {
            background: #ef4444;
            color: white;
        }
        
        .no-results {
            background: white;
            padding: 50px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .no-results h3 {
            font-size: 2em;
            color: #FFA500;
            margin-bottom: 20px;
        }
        
        .disclaimer {
            background: #FF6B6B;
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-top: 30px;
            text-align: center;
            line-height: 1.6;
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }
            
            .header::before, .header::after {
                display: none;
            }
            
            .scan-button {
                padding: 20px 40px;
                font-size: 20px;
            }
            
            .stock-ticker {
                font-size: 1.5em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üçã Lemon Squeeze v2.0</h1>
            <p>Short Squeeze Scanner + Daily Plays Pattern Detector</p>
            <span class="badge">v2.0 - 3-1 Strat Edition</span>
        </div>
        
        <!-- Tab Navigation -->
        <div class="tabs">
            <button class="tab-button active" onclick="switchTab('squeeze')">
                üçã Short Squeeze
            </button>
            <button class="tab-button" onclick="switchTab('daily')">
                üìà Daily Plays (3-1 Strat)
            </button>
        </div>
        
        <!-- Short Squeeze Tab -->
        <div id="squeezeTab" class="tab-content active">
            <div class="content">
                <div class="settings-panel">
                    <h2>‚öôÔ∏è Scan Settings</h2>
                    <div class="settings-grid">
                        <div class="setting-item">
                            <label for="minShort">Min Short Interest %</label>
                            <input type="number" id="minShort" value="25" step="1" min="0">
                        </div>
                        <div class="setting-item">
                            <label for="minGain">Min Daily Gain %</label>
                            <input type="number" id="minGain" value="15" step="1" min="0">
                        </div>
                        <div class="setting-item">
                            <label for="minVolRatio">Min Volume Ratio</label>
                            <input type="number" id="minVolRatio" value="1.5" step="0.1" min="0">
                        </div>
                        <div class="setting-item">
                            <label for="minRisk">Min Risk Score</label>
                            <input type="number" id="minRisk" value="60" step="1" min="0" max="100">
                        </div>
                    </div>
                </div>
                
                <div class="scan-section">
                    <button id="scanButton" class="scan-button" onclick="startSqueezeScan()">
                        üîç SCAN FOR SQUEEZES üçã
                    </button>
                </div>
                
                <div id="squeezeLoading" class="loading">
                    <div class="spinner"></div>
                    <div class="loading-text">Squeezing lemons... üçã</div>
                </div>
                
                <div id="squeezeResults" class="results"></div>
                
                <div class="disclaimer">
                    <strong>‚ö†Ô∏è IMPORTANT DISCLAIMER</strong>
                    This tool is for informational and educational purposes only. Short squeezes are extremely high-risk and volatile. 
                    Past performance does not guarantee future results. Always conduct your own research (DYOR) and never invest more 
                    than you can afford to lose. This is NOT financial advice!
                </div>
            </div>
        </div>
        
        <!-- Daily Plays Tab -->
        <div id="dailyTab" class="tab-content">
            <div class="content">
                <div class="settings-panel">
                    <h2>üìö The 3-1 Strat Pattern</h2>
                    <div style="background: #FFE97F; padding: 20px; border-radius: 10px;">
                        <ul style="margin-top: 10px; margin-left: 20px; line-height: 1.8; font-size: 1.1em;">
                            <li><strong>"3" = Outside Bar:</strong> Higher high + lower low than previous candle (expansion)</li>
                            <li><strong>"1" = Inside Bar:</strong> Lower high + higher low than previous candle (consolidation)</li>
                            <li><strong>Setup:</strong> When a "1" follows a "3", it signals consolidation before a potential breakout</li>
                        </ul>
                        <p style="margin-top: 15px; padding: 10px; background: white; border-radius: 5px; font-style: italic;">
                            üí° This scanner checks 100+ popular stocks + high short interest stocks for this pattern
                        </p>
                    </div>
                </div>
                
                <div class="scan-section">
                    <button id="dailyButton" class="scan-button" onclick="startDailyScan()">
                        üìà SCAN ALL PATTERNS üéØ
                    </button>
                </div>
                
                <div id="dailyLoading" class="loading">
                    <div class="spinner"></div>
                    <div class="loading-text">Finding patterns... üéØ</div>
                </div>
                
                <div id="dailyResults" class="results"></div>
                
                <div class="disclaimer">
                    <strong>‚ö†Ô∏è IMPORTANT DISCLAIMER</strong>
                    Technical patterns are educational tools, not guarantees. Markets are unpredictable and pattern failures are common.
                    Always use proper risk management, set stop losses, and never risk more than you can afford to lose. This is NOT financial advice!
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let isScanning = false;
        
        // Tab switching
        function switchTab(tab) {
            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            if (tab === 'squeeze') {
                document.getElementById('squeezeTab').classList.add('active');
            } else if (tab === 'daily') {
                document.getElementById('dailyTab').classList.add('active');
            }
        }
        
        // Short Squeeze Scanner
        async function startSqueezeScan() {
            if (isScanning) return;
            
            const minShort = parseFloat(document.getElementById('minShort').value);
            const minGain = parseFloat(document.getElementById('minGain').value);
            const minVolRatio = parseFloat(document.getElementById('minVolRatio').value);
            const minRisk = parseFloat(document.getElementById('minRisk').value);
            
            if (isNaN(minShort) || isNaN(minGain) || isNaN(minVolRatio) || isNaN(minRisk)) {
                alert('Please enter valid numbers!');
                return;
            }
            
            isScanning = true;
            document.getElementById('scanButton').disabled = true;
            document.getElementById('scanButton').textContent = '‚è≥ SCANNING...';
            document.getElementById('squeezeLoading').classList.add('active');
            document.getElementById('squeezeResults').classList.remove('active');
            
            try {
                const response = await fetch('/api/scan', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        minShort,
                        minGain,
                        minVolRatio,
                        minRisk
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    displaySqueezeResults(data.results, minShort, minGain, minVolRatio, minRisk);
                } else {
                    alert('Error: ' + data.error);
                }
                
            } catch (error) {
                alert('Error scanning: ' + error.message);
            } finally {
                isScanning = false;
                document.getElementById('scanButton').disabled = false;
                document.getElementById('scanButton').textContent = 'üîç SCAN FOR SQUEEZES üçã';
                document.getElementById('squeezeLoading').classList.remove('active');
            }
        }
        
        function displaySqueezeResults(candidates, minShort, minGain, minVolRatio, minRisk) {
            const resultsDiv = document.getElementById('squeezeResults');
            resultsDiv.classList.add('active');
            
            if (candidates.length === 0) {
                resultsDiv.innerHTML = `
                    <div class="no-results">
                        <h3>üçã No Squeezes Found Today</h3>
                        <p style="font-size: 1.2em; color: #666; margin: 20px 0;">
                            No stocks met the criteria: Short Interest ‚â•${minShort}% AND Daily Gain ‚â•+${minGain}%
                        </p>
                        <p style="color: #999;">
                            üí° Try lowering the thresholds or check back later!<br>
                            The market might just be having a calm day.
                        </p>
                    </div>
                `;
                return;
            }
            
            const avgGain = candidates.reduce((sum, s) => sum + s.dailyChange, 0) / candidates.length;
            const maxGain = Math.max(...candidates.map(s => s.dailyChange));
            const avgShort = candidates.reduce((sum, s) => sum + s.shortInterest, 0) / candidates.length;
            const avgRisk = candidates.reduce((sum, s) => sum + s.riskScore, 0) / candidates.length;
            
            let html = `
                <div class="results-header">
                    <h2>üöÄ Squeeze Candidates Found!</h2>
                    <p style="font-size: 1.2em; color: #666; margin: 10px 0;">
                        ${new Date().toLocaleString()}
                    </p>
                    <div class="summary-stats">
                        <div class="stat">
                            <span class="stat-value">${candidates.length}</span>
                            <span class="stat-label">Candidates</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value">${avgRisk.toFixed(1)}</span>
                            <span class="stat-label">Avg Risk Score</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value">+${avgGain.toFixed(2)}%</span>
                            <span class="stat-label">Avg Gain</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value">+${maxGain.toFixed(2)}%</span>
                            <span class="stat-label">Max Gain</span>
                        </div>
                    </div>
                </div>
            `;
            
            candidates.forEach((stock, idx) => {
                let riskClass, riskLabel, riskEmoji;
                if (stock.riskScore >= 90) {
                    riskClass = 'risk-extreme';
                    riskLabel = 'EXTREME';
                    riskEmoji = 'üî•üî•üî•';
                } else if (stock.riskScore >= 80) {
                    riskClass = 'risk-high';
                    riskLabel = 'HIGH';
                    riskEmoji = 'üöÄüöÄ';
                } else if (stock.riskScore >= 70) {
                    riskClass = 'risk-good';
                    riskLabel = 'GOOD';
                    riskEmoji = 'üí™';
                } else {
                    riskClass = 'risk-moderate';
                    riskLabel = 'MODERATE';
                    riskEmoji = '‚úÖ';
                }
                
                html += `
                    <div class="stock-card">
                        <div class="stock-header">
                            <div class="stock-ticker">#${idx + 1}. ${stock.ticker}</div>
                            <div class="risk-badge ${riskClass}">
                                ${stock.riskScore}/100 ${riskEmoji}
                            </div>
                        </div>
                        <div class="stock-company">${stock.company}</div>
                        
                        <div class="metrics-grid">
                            <div class="metric-section">
                                <h4>üìä Core Metrics</h4>
                                <div class="metric-item">
                                    <span class="metric-label">Short Interest:</span>
                                    <span class="metric-value">${stock.shortInterest.toFixed(2)}%</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Daily Gain:</span>
                                    <span class="metric-value" style="color: #10b981;">+${stock.dailyChange.toFixed(2)}%</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Price Move:</span>
                                    <span class="metric-value">$${stock.previousClose.toFixed(2)} ‚Üí $${stock.currentPrice.toFixed(2)}</span>
                                </div>
                            </div>
                            
                            <div class="metric-section">
                                <h4>üìà Volume Analysis</h4>
                                <div class="metric-item">
                                    <span class="metric-label">Current Vol:</span>
                                    <span class="metric-value">${stock.volume.toLocaleString()}</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Avg Volume:</span>
                                    <span class="metric-value">${stock.avgVolume.toLocaleString()}</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Volume Ratio:</span>
                                    <span class="metric-value">${stock.volumeRatio.toFixed(2)}x ${stock.volumeRatio >= 3 ? 'üî•' : stock.volumeRatio >= 2 ? 'üöÄ' : '‚úÖ'}</span>
                                </div>
                            </div>
                            
                            <div class="metric-section">
                                <h4>‚öôÔ∏è Squeeze Mechanics</h4>
                                <div class="metric-item">
                                    <span class="metric-label">Float:</span>
                                    <span class="metric-value">${(stock.floatShares / 1000000).toFixed(1)}M</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Days to Cover:</span>
                                    <span class="metric-value">${stock.daysToCover.toFixed(2)} ${stock.daysToCover >= 5 ? 'üöÄ' : '‚úÖ'}</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Market Cap:</span>
                                    <span class="metric-value">$${(stock.marketCap / 1000000).toFixed(1)}M</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            resultsDiv.innerHTML = html;
        }
        
        // Daily Plays Scanner
        async function startDailyScan() {
            if (isScanning) return;
            
            isScanning = true;
            document.getElementById('dailyButton').disabled = true;
            document.getElementById('dailyButton').textContent = '‚è≥ SCANNING...';
            document.getElementById('dailyLoading').classList.add('active');
            document.getElementById('dailyResults').classList.remove('active');
            
            try {
                const response = await fetch('/api/daily-plays', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({})  // No filters needed
                });
                
                const data = await response.json();
                
                if (data.success) {
                    displayDailyResults(data.results);
                } else {
                    alert('Error: ' + data.error);
                }
                
            } catch (error) {
                alert('Error scanning: ' + error.message);
                console.error('Scan error:', error);
            } finally {
                isScanning = false;
                document.getElementById('dailyButton').disabled = false;
                document.getElementById('dailyButton').textContent = 'üìà SCAN ALL PATTERNS üéØ';
                document.getElementById('dailyLoading').classList.remove('active');
            }
        }
        
        function displayDailyResults(patterns) {
            const resultsDiv = document.getElementById('dailyResults');
            resultsDiv.classList.add('active');
            
            if (patterns.length === 0) {
                resultsDiv.innerHTML = `
                    <div class="no-results">
                        <h3>üéØ No Patterns Found Today</h3>
                        <p style="font-size: 1.2em; color: #666; margin: 20px 0;">
                            No stocks showed the 3-1 Strat pattern today
                        </p>
                        <p style="color: #999;">
                            üí° Market conditions may not be favorable right now.<br>
                            Check back later or try during market hours!
                        </p>
                    </div>
                `;
                return;
            }
            
            const bullishCount = patterns.filter(p => p.pattern.direction === 'bullish').length;
            const bearishCount = patterns.filter(p => p.pattern.direction === 'bearish').length;
            const totalVolume = patterns.reduce((sum, p) => sum + p.volume, 0);
            const avgVolume = totalVolume / patterns.length;
            
            let html = `
                <div class="results-header">
                    <h2>üéØ 3-1 Strat Patterns Found!</h2>
                    <p style="font-size: 1.2em; color: #666; margin: 10px 0;">
                        ${new Date().toLocaleString()}
                    </p>
                    <div class="summary-stats">
                        <div class="stat">
                            <span class="stat-value">${patterns.length}</span>
                            <span class="stat-label">Total Patterns</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value" style="color: #10b981;">${bullishCount}</span>
                            <span class="stat-label">Bullish</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value" style="color: #ef4444;">${bearishCount}</span>
                            <span class="stat-label">Bearish</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value">${(avgVolume / 1000000).toFixed(1)}M</span>
                            <span class="stat-label">Avg Volume</span>
                        </div>
                    </div>
                </div>
            `;
            
            patterns.forEach((stock, idx) => {
                const pattern = stock.pattern;
                const patternClass = pattern.direction === 'bullish' ? 'pattern-bullish' : 'pattern-bearish';
                const patternEmoji = pattern.direction === 'bullish' ? 'üìà' : 'üìâ';
                
                html += `
                    <div class="pattern-card">
                        <div class="stock-header">
                            <div class="stock-ticker">#${idx + 1}. ${stock.ticker}</div>
                            <div class="pattern-badge ${patternClass}">
                                ${patternEmoji} ${pattern.direction.toUpperCase()}
                            </div>
                        </div>
                        <div class="stock-company">${stock.company}</div>
                        
                        <div class="pattern-info">
                            <h4 style="color: #FFA500; margin-bottom: 10px;">üìä Pattern Details</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <strong style="color: #666;">3Ô∏è‚É£ Outside Bar (${pattern.three_candle.date}):</strong><br>
                                    High: $${pattern.three_candle.high.toFixed(2)}<br>
                                    Low: $${pattern.three_candle.low.toFixed(2)}<br>
                                    Close: $${pattern.three_candle.close.toFixed(2)}
                                </div>
                                <div>
                                    <strong style="color: #666;">1Ô∏è‚É£ Inside Bar (${pattern.one_candle.date}):</strong><br>
                                    High: $${pattern.one_candle.high.toFixed(2)}<br>
                                    Low: $${pattern.one_candle.low.toFixed(2)}<br>
                                    Open: $${pattern.one_candle.open.toFixed(2)}<br>
                                    Close: $${pattern.one_candle.close.toFixed(2)}
                                </div>
                            </div>
                            <div style="background: white; padding: 10px; border-radius: 5px; margin-top: 10px;">
                                <strong>üí° Interpretation:</strong> 
                                The stock formed an outside bar (expansion) followed by an inside bar (consolidation). 
                                This ${pattern.direction} setup suggests potential breakout ${pattern.direction === 'bullish' ? 'above' : 'below'} 
                                the inside bar's range.
                            </div>
                        </div>
                        
                        <div class="metrics-grid" style="margin-top: 20px;">
                            <div class="metric-section">
                                <h4>üí∞ Price Info</h4>
                                <div class="metric-item">
                                    <span class="metric-label">Current Price:</span>
                                    <span class="metric-value">$${stock.currentPrice.toFixed(2)}</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Daily Change:</span>
                                    <span class="metric-value" style="color: ${stock.dailyChange >= 0 ? '#10b981' : '#ef4444'};">
                                        ${stock.dailyChange >= 0 ? '+' : ''}${stock.dailyChange.toFixed(2)}%
                                    </span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Market Cap:</span>
                                    <span class="metric-value">$${(stock.marketCap / 1000000).toFixed(1)}M</span>
                                </div>
                            </div>
                            
                            <div class="metric-section">
                                <h4>üìä Volume Info</h4>
                                <div class="metric-item">
                                    <span class="metric-label">Current Vol:</span>
                                    <span class="metric-value">${stock.volume.toLocaleString()}</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Avg Volume:</span>
                                    <span class="metric-value">${stock.avgVolume.toLocaleString()}</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Volume Ratio:</span>
                                    <span class="metric-value">${(stock.volume / stock.avgVolume).toFixed(2)}x</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            resultsDiv.innerHTML = html;
        }
    </script>
</body>
</html>
