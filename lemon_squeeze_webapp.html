<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üçã Lemon Squeeze v5.0 - Find A Play Multi-Timeframe Scanner</title>
    <style>
        :root {
            /* Light mode colors */
            --bg-gradient-start: #FFD700;
            --bg-gradient-end: #FFA500;
            --container-bg: #FFF9E6;
            --text-primary: #333;
            --text-secondary: #666;
            --card-bg: white;
            --border-color: #FFD700;
            --settings-bg: #FFE97F;
            --shadow: rgba(0,0,0,0.1);
            --shadow-heavy: rgba(0,0,0,0.3);
        }
        
        [data-theme="dark"] {
            /* Dark mode colors */
            --bg-gradient-start: #1a1a2e;
            --bg-gradient-end: #16213e;
            --container-bg: #0f3460;
            --text-primary: #eee;
            --text-secondary: #ccc;
            --card-bg: #1a1a2e;
            --border-color: #FFA500;
            --settings-bg: #16213e;
            --shadow: rgba(0,0,0,0.3);
            --shadow-heavy: rgba(0,0,0,0.5);
        }
        
        /* Fix text colors in dark mode for info boxes */
        [data-theme="dark"] .settings-panel div[style*="background: #FFE97F"],
        [data-theme="dark"] .settings-panel div[style*="background:#FFE97F"] {
            background: #2d3748 !important;
            color: #e2e8f0 !important;
        }
        
        [data-theme="dark"] .settings-panel div[style*="background: white"],
        [data-theme="dark"] .settings-panel div[style*="background:white"],
        [data-theme="dark"] .pattern-info div[style*="background: white"],
        [data-theme="dark"] .pattern-info div[style*="background:white"] {
            background: #1a202c !important;
            color: #e2e8f0 !important;
        }
        
        [data-theme="dark"] .settings-panel ul,
        [data-theme="dark"] .settings-panel p,
        [data-theme="dark"] .settings-panel li,
        [data-theme="dark"] .settings-panel strong {
            color: #e2e8f0 !important;
        }
        
        [data-theme="dark"] .pattern-info strong,
        [data-theme="dark"] .pattern-info p {
            color: #e2e8f0 !important;
        }
        
        /* Fix summary stats text in dark mode */
        [data-theme="dark"] .results-header p {
            color: #cbd5e0 !important;
        }
        
        /* Fix inline styled elements in dark mode */
        [data-theme="dark"] div[style*="color: #666"],
        [data-theme="dark"] div[style*="color:#666"],
        [data-theme="dark"] span[style*="color: #666"],
        [data-theme="dark"] p[style*="color: #666"] {
            color: #cbd5e0 !important;
        }
        
        [data-theme="dark"] div[style*="color: #999"],
        [data-theme="dark"] p[style*="color: #999"] {
            color: #a0aec0 !important;
        }
        
        /* Fix "no results" message */
        [data-theme="dark"] .no-results p {
            color: #cbd5e0 !important;
        }
        
        /* Make sure orange colors pop in dark mode */
        [data-theme="dark"] .settings-panel h2,
        [data-theme="dark"] .metric-section h4 {
            color: #fb923c !important;
        }
        
        /* Improve readability of all paragraph text in dark mode */
        [data-theme="dark"] p,
        [data-theme="dark"] li,
        [data-theme="dark"] span:not(.stat-value):not(.metric-value) {
            color: #e2e8f0;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1300px;
            margin: 0 auto;
            background: var(--container-bg);
            border-radius: 20px;
            box-shadow: 0 20px 60px var(--shadow-heavy);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
            color: var(--text-primary);
            padding: 40px;
            text-align: center;
            position: relative;
        }
        
        /* Toolbar - Desktop */
        .toolbar {
            background: var(--card-bg);
            padding: 15px 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            box-shadow: 0 2px 10px var(--shadow);
            border-bottom: 2px solid var(--border-color);
        }
        
        /* Floating actions - Hidden on desktop, shown on mobile */
        .floating-actions {
            display: none;
        }
        
        /* Dark Mode Toggle */
        .dark-mode-toggle {
            background: var(--settings-bg);
            border: 2px solid var(--border-color);
            border-radius: 50px;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 1em;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-primary);
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .dark-mode-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px var(--shadow);
            background: var(--border-color);
        }
        
        /* Favorites Button */
        .favorites-toggle {
            background: linear-gradient(135deg, #FFA500 0%, #FF8C00 100%);
            border: none;
            border-radius: 50px;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 1em;
            display: flex;
            align-items: center;
            gap: 8px;
            color: white;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(255, 165, 0, 0.3);
        }
        
        .favorites-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 165, 0, 0.5);
        }
        
        .favorites-count {
            background: white;
            color: #FFA500;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85em;
            font-weight: bold;
        }
        
        .header::before, .header::after {
            content: "üçã";
            position: absolute;
            font-size: 100px;
            opacity: 0.1;
            top: 20px;
        }
        
        .header::before { left: 50px; }
        .header::after { right: 50px; }
        
        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .header p {
            font-size: 1.3em;
            font-style: italic;
            opacity: 0.9;
        }
        
        .badge {
            display: inline-block;
            background: #FF6B6B;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-top: 10px;
            font-weight: bold;
        }
        
        /* Tab Navigation */
        .tabs {
            display: flex;
            justify-content: center;
            background: var(--settings-bg);
            padding: 0;
            margin: 0;
        }
        
        .tab-button {
            flex: 1;
            max-width: 200px;
            padding: 18px 15px;
            background: transparent;
            border: none;
            font-size: 1.05em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            color: var(--text-secondary);
            border-bottom: 4px solid transparent;
        }
        
        .tab-button:hover {
            background: var(--card-bg);
            opacity: 0.8;
        }
        
        .tab-button.active {
            background: var(--container-bg);
            color: #FFA500;
            border-bottom: 4px solid #FFA500;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .content {
            padding: 40px;
        }
        
        .settings-panel {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px var(--shadow);
            color: var(--text-primary);
        }
        
        .settings-panel h2 {
            color: #FFA500;
            margin-bottom: 20px;
            font-size: 1.5em;
        }
        
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .setting-item {
            display: flex;
            flex-direction: column;
        }
        
        label {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
            font-size: 1.1em;
        }
        
        input[type="number"] {
            padding: 12px;
            border: 3px solid var(--border-color);
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            transition: all 0.3s;
            background: var(--card-bg);
            color: var(--text-primary);
        }
        
        select {
            padding: 12px;
            border: 3px solid var(--border-color);
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            transition: all 0.3s;
            background: var(--card-bg);
            cursor: pointer;
            color: var(--text-primary);
        }
        
        input[type="number"]:focus, select:focus {
            outline: none;
            border-color: #FFA500;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
        }
        
        .scan-section {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .scan-button {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: #333;
            border: none;
            padding: 25px 60px;
            font-size: 28px;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 8px 25px rgba(255, 165, 0, 0.4);
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .scan-button:hover:not(:disabled) {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(255, 165, 0, 0.6);
        }
        
        .scan-button:active {
            transform: translateY(-2px);
        }
        
        .scan-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .loading.active {
            display: block;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #FFD700;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            font-size: 1.2em;
            color: #666;
            font-weight: 600;
        }
        
        .results {
            display: none;
        }
        
        .results.active {
            display: block;
        }
        
        .results-header {
            background: var(--card-bg);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px var(--shadow);
            text-align: center;
            color: var(--text-primary);
        }
        
        .results-header h2 {
            color: #FFA500;
            font-size: 2em;
            margin-bottom: 15px;
        }
        
        .summary-stats {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }
        
        .stat {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #FFA500;
        }
        
        .stat-label {
            font-size: 1em;
            color: var(--text-secondary);
            margin-top: 5px;
        }
        
        .stock-card, .pattern-card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px var(--shadow);
            transition: transform 0.3s, box-shadow 0.3s;
            color: var(--text-primary);
            position: relative;
        }
        
        .stock-card:hover, .pattern-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px var(--shadow-heavy);
        }
        
        /* Add to Favorites Button */
        .favorite-btn {
            background: transparent;
            border: 3px solid #FFA500;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            cursor: pointer;
            font-size: 1.6em;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            flex-shrink: 0;
        }
        
        .favorite-btn:hover {
            background: #FFA500;
            transform: scale(1.15) rotate(15deg);
            box-shadow: 0 6px 20px rgba(255, 165, 0, 0.5);
        }
        
        .favorite-btn.active {
            background: #FFA500;
            border-color: #FF8C00;
            box-shadow: 0 4px 15px rgba(255, 165, 0, 0.4);
        }
        
        /* Chart Container */
        .chart-container {
            width: 100%;
            height: 300px;
            margin: 20px 0;
            background: var(--container-bg);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .stock-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            gap: 15px;
        }
        
        .stock-title-row {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
        }
        
        .stock-ticker {
            font-size: 2em;
            font-weight: bold;
            color: var(--text-primary);
        }
        
        .stock-company {
            font-size: 1.2em;
            color: var(--text-secondary);
            margin-bottom: 20px;
        }
        
        .risk-badge {
            padding: 12px 20px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 1.2em;
        }
        
        .risk-extreme {
            background: linear-gradient(135deg, #FF0000 0%, #CC0000 100%);
            color: white;
            animation: pulse 2s ease-in-out infinite;
        }
        
        .risk-high {
            background: linear-gradient(135deg, #FF6B6B 0%, #FF4444 100%);
            color: white;
        }
        
        .risk-good {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        
        .risk-moderate {
            background: linear-gradient(135deg, #FFA500 0%, #FF8C00 100%);
            color: white;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .metric-section {
            background: var(--settings-bg);
            padding: 15px;
            border-radius: 10px;
        }
        
        .metric-section h4 {
            color: #FFA500;
            margin-bottom: 12px;
            font-size: 1.1em;
        }
        
        .metric-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
        }
        
        .metric-item:last-child {
            border-bottom: none;
        }
        
        .metric-label {
            color: var(--text-secondary);
            font-weight: 600;
        }
        
        .metric-value {
            color: var(--text-primary);
            font-weight: bold;
        }
        
        .pattern-info {
            background: var(--settings-bg);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
        }
        
        .pattern-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            margin: 5px;
        }
        
        .pattern-bullish {
            background: #10b981;
            color: white;
        }
        
        .pattern-bearish {
            background: #ef4444;
            color: white;
        }
        
        .no-results {
            background: var(--card-bg);
            padding: 50px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 4px 15px var(--shadow);
            color: var(--text-primary);
        }
        
        .no-results h3 {
            font-size: 2em;
            color: #FFA500;
            margin-bottom: 20px;
        }
        
        /* Favorites Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 20px;
            max-width: 800px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px var(--shadow-heavy);
            color: var(--text-primary);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 15px;
        }
        
        .modal-header h2 {
            color: #FFA500;
            font-size: 2em;
        }
        
        .modal-close {
            background: transparent;
            border: none;
            font-size: 2em;
            cursor: pointer;
            color: var(--text-primary);
            padding: 0;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
        }
        
        .modal-close:hover {
            background: var(--settings-bg);
            transform: rotate(90deg);
        }
        
        .favorite-item {
            background: var(--settings-bg);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }
        
        .favorite-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 15px var(--shadow);
        }
        
        .favorite-info {
            flex: 1;
        }
        
        .favorite-ticker {
            font-size: 1.5em;
            font-weight: bold;
            color: var(--text-primary);
        }
        
        .favorite-meta {
            color: var(--text-secondary);
            font-size: 0.9em;
            margin-top: 5px;
        }
        
        .favorite-actions {
            display: flex;
            gap: 10px;
        }
        
        .favorite-scan-btn, .favorite-remove-btn {
            padding: 8px 16px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .favorite-scan-btn {
            background: #10b981;
            color: white;
        }
        
        .favorite-scan-btn:hover {
            background: #059669;
            transform: scale(1.05);
        }
        
        .favorite-remove-btn {
            background: #ef4444;
            color: white;
        }
        
        .favorite-remove-btn:hover {
            background: #dc2626;
            transform: scale(1.05);
        }
        
        /* Win Rate Badge */
        .win-rate-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.9em;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .win-rate-high {
            background: #10b981;
            color: white;
        }
        
        .win-rate-medium {
            background: #FFA500;
            color: white;
        }
        
        .win-rate-low {
            background: #ef4444;
            color: white;
        }
        
        .win-rate-new {
            background: #666;
            color: white;
        }
        
        .disclaimer {
            background: #FF6B6B;
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-top: 30px;
            text-align: center;
            line-height: 1.6;
        }
        
        [data-theme="dark"] .disclaimer {
            background: #991b1b;
            color: #fee2e2;
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }
            
            .header::before, .header::after {
                display: none;
            }
            
            /* Hide toolbar on mobile */
            .toolbar {
                display: none;
            }
            
            /* Show floating buttons on mobile */
            .floating-actions {
                display: flex;
                position: fixed;
                bottom: 20px;
                right: 20px;
                flex-direction: column;
                gap: 12px;
                z-index: 1000;
            }
            
            .floating-actions .dark-mode-toggle {
                border-radius: 50%;
                width: 56px;
                height: 56px;
                padding: 0;
                font-size: 1.4em;
                box-shadow: 0 4px 20px var(--shadow-heavy);
            }
            
            .floating-actions .dark-mode-toggle:hover {
                transform: scale(1.1) rotate(10deg);
            }
            
            .floating-actions .dark-mode-toggle #darkModeText {
                display: none;
            }
            
            .floating-actions .favorites-toggle {
                border-radius: 50%;
                width: 56px;
                height: 56px;
                padding: 0;
                font-size: 1.6em;
                position: relative;
                box-shadow: 0 4px 20px rgba(255, 165, 0, 0.5);
            }
            
            .floating-actions .favorites-toggle:hover {
                transform: scale(1.1);
            }
            
            .floating-actions .favorites-toggle > span:not(.favorites-count) {
                display: none;
            }
            
            .floating-actions .favorites-toggle::before {
                content: '‚≠ê';
                font-size: 1em;
            }
            
            .floating-actions .favorites-count {
                position: absolute;
                top: -5px;
                right: -5px;
                background: #ef4444;
                border: 2px solid white;
                width: 22px;
                height: 22px;
                font-size: 0.7em;
            }
            
            .scan-button {
                padding: 20px 40px;
                font-size: 20px;
            }
            
            .stock-ticker {
                font-size: 1.5em;
            }
            
            .tab-button {
                font-size: 0.9em;
                padding: 15px 10px;
            }
        }
        /* Multi-Timeframe Table Styles for Find A Play */
        .timeframe-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--card-bg);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 15px var(--shadow);
            margin-bottom: 20px;
        }
        
        .timeframe-table thead {
            background: linear-gradient(135deg, #FFA500 0%, #FF8C00 100%);
            color: white;
        }
        
        .timeframe-table th {
            padding: 18px;
            text-align: left;
            font-size: 1.1em;
            font-weight: bold;
        }
        
        .timeframe-table td {
            padding: 15px 18px;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-primary);
        }
        
        .timeframe-table tr:hover {
            background: var(--settings-bg);
        }
        
        .strength-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 1.1em;
        }
        
        .strength-3 {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
            animation: pulse 2s ease-in-out infinite;
        }
        
        .strength-2 {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(251, 191, 36, 0.4);
        }
        
        .strength-1 {
            background: linear-gradient(135deg, #94a3b8 0%, #64748b 100%);
            color: white;
        }
        
        .pattern-indicator {
            padding: 6px 12px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 0.95em;
            display: inline-block;
        }
        
        .pattern-bullish {
            background: #10b981;
            color: white;
        }
        
        .pattern-bearish {
            background: #ef4444;
            color: white;
        }
        
        .pattern-neutral {
            background: #64748b;
            color: white;
        }
        
        .pattern-none {
            color: var(--text-secondary);
            font-size: 1.2em;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üçã Lemon Squeeze v2.0</h1>
            <p>Multi-Timeframe Scanner: Stocks & Crypto</p>
            <span class="badge">v2.0 - Hourly ‚Ä¢ Daily ‚Ä¢ Weekly ‚Ä¢ Crypto</span>
        </div>
        
        <!-- Toolbar with actions -->
        <div class="toolbar">
            <button class="favorites-toggle" onclick="toggleFavoritesModal()">
                <span>‚≠ê</span>
                <span>Favorites</span>
                <span class="favorites-count" id="favoritesCount">0</span>
            </button>
            <button class="dark-mode-toggle" onclick="toggleDarkMode()" id="darkModeToggle">
                <span id="darkModeIcon">üåô</span>
                <span id="darkModeText">Dark</span>
            </button>
        </div>
        
        <!-- Tab Navigation -->
        <div class="tabs">
            <button class="tab-button active" onclick="switchTab('squeeze')">
                üçã Short Squeeze
            </button>
            <button class="tab-button" onclick="switchTab('findaplay')">
                üéØ Find A Play
            </button>
            <button class="tab-button" onclick="switchTab('crypto')">
                ‚Çø Crypto
            </button>
            <button class="tab-button" onclick="switchTab('volemon')">
                üîä Volemon
            </button>
            <button class="tab-button" onclick="switchTab('usuals')">
                ‚≠ê Usuals
            </button>
        </div>
        
        <!-- Short Squeeze Tab -->
        <div id="squeezeTab" class="tab-content active">
            <div class="content">
                <div class="settings-panel">
                    <h2>‚öôÔ∏è Scan Settings</h2>
                    <div class="settings-grid">
                        <div class="setting-item">
                            <label for="minShort">Min Short Interest %</label>
                            <input type="number" id="minShort" value="25" step="1" min="0">
                        </div>
                        <div class="setting-item">
                            <label for="minGain">Min Daily Gain %</label>
                            <input type="number" id="minGain" value="15" step="1" min="0">
                        </div>
                        <div class="setting-item">
                            <label for="minVolRatio">Min Volume Ratio</label>
                            <input type="number" id="minVolRatio" value="1.5" step="0.1" min="0">
                        </div>
                        <div class="setting-item">
                            <label for="minRisk">Min Risk Score</label>
                            <input type="number" id="minRisk" value="60" step="1" min="0" max="100">
                        </div>
                    </div>
                </div>
                
                <div class="scan-section">
                    <button id="scanButton" class="scan-button" onclick="startSqueezeScan()">
                        üîç SCAN FOR SQUEEZES üçã
                    </button>
                </div>
                
                <div id="squeezeLoading" class="loading">
                    <div class="spinner"></div>
                    <div class="loading-text">Squeezing lemons... üçã</div>
                </div>
                
                <div id="squeezeResults" class="results"></div>
                
                <div class="disclaimer">
                    <strong>‚ö†Ô∏è IMPORTANT DISCLAIMER</strong>
                    This tool is for informational and educational purposes only. Short squeezes are extremely high-risk and volatile. 
                    Past performance does not guarantee future results. Always conduct your own research (DYOR) and never invest more 
                    than you can afford to lose. This is NOT financial advice!
                </div>
            </div>
        </div>
        
        <!-- Find A Play Tab (Multi-Timeframe) -->
        <div id="findaplayTab" class="tab-content">
            <div class="content">
                <div class="settings-panel">
                    <h2>üìö The 3-1 Strat Pattern & Inside Bars</h2>
                    <div style="background: #FFE97F; padding: 20px; border-radius: 10px;">
                        <p style="font-size: 1.2em; margin-bottom: 15px;"><strong>What This Scanner Detects:</strong></p>
                        <ul style="margin-top: 10px; margin-left: 20px; line-height: 1.8; font-size: 1.1em;">
                            <li><strong>"3" = Outside Bar:</strong> Higher high + lower low than previous candle (expansion/volatility)</li>
                            <li><strong>"1" = Inside Bar:</strong> Lower high + higher low than previous candle (consolidation/pause)</li>
                            <li><strong>3-1 Setup:</strong> When a "1" follows a "3", it signals consolidation after expansion - prime setup for breakout!</li>
                            <li><strong>Inside Bars Alone:</strong> Consolidation patterns that often precede significant moves in either direction</li>
                            <li><strong>Multi-Timeframe:</strong> Checks Daily, Weekly, AND Hourly patterns all at once</li>
                            <li><strong>Strength Scoring:</strong> ‚≠ê‚≠ê‚≠ê = Pattern on all 3 timeframes (STRONGEST signal)</li>
                        </ul>
                        <p style="margin-top: 15px; padding: 10px; background: white; border-radius: 5px; font-style: italic;">
                            üéØ <strong>Pro Tip:</strong> Professional traders ALWAYS check multiple timeframes. When patterns align across daily, weekly, AND hourly charts, the probability of a successful setup increases dramatically!
                        </p>
                        <p style="margin-top: 10px; padding: 10px; background: white; border-radius: 5px; font-style: italic;">
                            üí° <strong>Pattern Priority:</strong> Look for ‚≠ê‚≠ê‚≠ê plays first (patterns on all 3 timeframes), then ‚≠ê‚≠ê plays (2 timeframes), then ‚≠ê plays (1 timeframe)
                        </p>
                    </div>
                </div>
                
                <div class="scan-section">
                    <button id="findaplayButton" class="scan-button" onclick="startFindAPlayScan()">
                        üéØ FIND A PLAY - SCAN ALL TIMEFRAMES! üçã
                    </button>
                </div>
                
                <div id="findaplayLoading" class="loading">
                    <div class="spinner"></div>
                    <div class="loading-text">Scanning 47 stocks across 3 timeframes... üéØ</div>
                </div>
                
                <div id="findaplayResults" class="results"></div>
                
                <div class="disclaimer">
                    <strong>‚ö†Ô∏è IMPORTANT DISCLAIMER</strong>
                    Multi-timeframe analysis provides powerful confirmation but does not guarantee success. Markets are unpredictable and pattern failures are common.
                    Always use proper risk management, set stop losses, and never risk more than you can afford to lose. This is NOT financial advice!
                </div>
            </div>
        </div>
        
        <!-- Crypto Tab -->
        <div id="cryptoTab" class="tab-content">
            <div class="content">
                <div class="settings-panel">
                    <h2>‚Çø Crypto 3-1 Strat Scanner</h2>
                    <div style="background: #FFE97F; padding: 20px; border-radius: 10px;">
                        <p style="font-size: 1.1em; margin-bottom: 15px;"><strong>Scanning:</strong> BTC, ETH, XRP, SOL, DOGE, HYPE</p>
                        <ul style="margin-left: 20px; line-height: 1.8; font-size: 1.1em;">
                            <li><strong>Multi-Timeframe:</strong> Checks hourly, daily, AND weekly patterns</li>
                            <li><strong>Crypto-Specific:</strong> 24/7 markets with unique volatility</li>
                            <li><strong>Quick Signals:</strong> Find patterns across all major cryptos instantly</li>
                        </ul>
                        <p style="margin-top: 15px; padding: 10px; background: white; border-radius: 5px; font-style: italic;">
                            ‚Çø Crypto patterns can signal explosive moves - trade with caution!
                        </p>
                    </div>
                </div>
                
                <div class="scan-section">
                    <button id="cryptoButton" class="scan-button" onclick="startCryptoScan()">
                        ‚Çø SCAN CRYPTO PATTERNS üöÄ
                    </button>
                </div>
                
                <div id="cryptoLoading" class="loading">
                    <div class="spinner"></div>
                    <div class="loading-text">Squeezing crypto lemons... üçã‚Çø</div>
                </div>
                
                <div id="cryptoResults" class="results"></div>
                
                <div class="disclaimer">
                    <strong>‚ö†Ô∏è IMPORTANT DISCLAIMER</strong>
                    Cryptocurrency trading is extremely high-risk and volatile. Prices can swing dramatically in minutes.
                    Never invest more than you can afford to lose. This is NOT financial advice!
                </div>
            </div>
        </div>
        
        <!-- Volemon Tab -->
        <div id="volemonTab" class="tab-content">
            <div class="content">
                <div class="settings-panel">
                    <h2>üîä Volemon - Volume Monster Scanner</h2>
                    <div style="background: #FFE97F; padding: 20px; border-radius: 10px;">
                        <p style="font-size: 1.1em; margin-bottom: 15px;"><strong>Auto-Scanner:</strong> Runs every 20 minutes automatically!</p>
                        <ul style="margin-left: 20px; line-height: 1.8; font-size: 1.1em;">
                            <li><strong>2x Volume:</strong> Finds stocks with 2x or more their average volume</li>
                            <li><strong>Auto-Only:</strong> No manual scanning needed - just watch the results</li>
                            <li><strong>Smart Timer:</strong> Countdown shows when next scan runs</li>
                        </ul>
                        <p style="margin-top: 15px; padding: 10px; background: white; border-radius: 5px; font-style: italic;">
                            üîä Volume spikes can signal big moves - Volemon catches them for you!
                        </p>
                    </div>
                    
                    <div style="margin-top: 20px; padding: 20px; background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%); border-radius: 10px; color: white;">
                        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                            <div>
                                <h3 style="margin-bottom: 5px;">üîÑ Scanner Status: ACTIVE</h3>
                                <p style="opacity: 0.9;">Next scan: <span id="volemonTimer" style="font-family: monospace; font-weight: bold;">20:00</span></p>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 2em; font-weight: bold;" id="totalScans">0</div>
                                <div style="opacity: 0.9;">Total Scans Today</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 2em; font-weight: bold;" id="stocksFound">0</div>
                                <div style="opacity: 0.9;">Stocks Found</div>
                            </div>
                        </div>
                        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.2); display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
                            <p style="margin: 0; opacity: 0.9;">Last scan: <span id="lastScan">Never</span></p>
                            <button onclick="clearVolemonResults()" style="background: rgba(239, 68, 68, 0.8); color: white; border: none; padding: 8px 16px; border-radius: 20px; cursor: pointer; font-weight: bold; transition: all 0.3s;" onmouseover="this.style.background='rgba(239, 68, 68, 1)'" onmouseout="this.style.background='rgba(239, 68, 68, 0.8)'">
                                üóëÔ∏è Clear All Results
                            </button>
                        </div>
                    </div>
                </div>
                
                <div id="volemonLoading" class="loading">
                    <div class="spinner"></div>
                    <div class="loading-text">Volemon hunting volume monsters... üîäüçã</div>
                </div>
                
                <div id="volemonResults" class="results"></div>
                
                <div class="disclaimer">
                    <strong>‚ö†Ô∏è IMPORTANT DISCLAIMER</strong>
                    High volume doesn't guarantee profits. Volume spikes can be due to news, earnings, or other factors.
                    Always do your own research. This is NOT financial advice!
                </div>
            </div>
        </div>
        
        <!-- Usuals Tab -->
        <div id="usualsTab" class="tab-content">
            <div class="content">
                <div class="settings-panel">
                    <h2>‚≠ê The Usuals - Your Watchlist</h2>
                    <div style="background: #FFE97F; padding: 20px; border-radius: 10px;">
                        <p style="font-size: 1.1em; margin-bottom: 15px;"><strong>Tracking:</strong> SOFI, INTC, SPY, TSLA, COIN, CDE, PLTR, AAPL, BAC, NVDA, GOOGL, META, MSFT, UNH</p>
                        <ul style="margin-left: 20px; line-height: 1.8; font-size: 1.1em;">
                            <li><strong>Auto-Updates:</strong> Scans every 15 minutes automatically</li>
                            <li><strong>Multi-Timeframe:</strong> Shows 3-1 patterns on Daily, Weekly, Hourly, 4H</li>
                            <li><strong>Volume Analysis:</strong> Current vs average volume with percentage</li>
                            <li><strong>Top News:</strong> Latest 2 headlines per stock (no fluff!)</li>
                        </ul>
                        <p style="margin-top: 15px; padding: 10px; background: white; border-radius: 5px; font-style: italic;">
                            ‚≠ê Your go-to stocks, always monitored, always updated!
                        </p>
                    </div>
                    
                    <div style="margin-top: 20px; padding: 20px; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); border-radius: 10px; color: white;">
                        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                            <div>
                                <h3 style="margin-bottom: 5px;">üîÑ Scanner Status: ACTIVE</h3>
                                <p style="opacity: 0.9;">Next scan: <span id="usualsTimer" style="font-family: monospace; font-weight: bold;">15:00</span></p>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 2em; font-weight: bold;" id="usualsTotalScans">0</div>
                                <div style="opacity: 0.9;">Scans Today</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 2em; font-weight: bold;" id="usualsPatterns">0</div>
                                <div style="opacity: 0.9;">Patterns Found</div>
                            </div>
                        </div>
                        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.2);">
                            <p style="margin: 0; opacity: 0.9;">Last update: <span id="usualsLastScan">Never</span></p>
                        </div>
                    </div>
                </div>
                
                <div id="usualsLoading" class="loading">
                    <div class="spinner"></div>
                    <div class="loading-text">Scanning your usuals... ‚≠êüçã</div>
                </div>
                
                <div id="usualsResults" class="results"></div>
                
                <div class="disclaimer">
                    <strong>‚ö†Ô∏è IMPORTANT DISCLAIMER</strong>
                    This is for informational purposes only. Stock prices are volatile and past performance doesn't guarantee future results.
                    Always do your own research. This is NOT financial advice!
                </div>
            </div>
        </div>
    </div>
    
    <!-- Floating Actions (Mobile Only) -->
    <div class="floating-actions">
        <button class="favorites-toggle" onclick="toggleFavoritesModal()">
            <span>‚≠ê</span>
            <span>Favorites</span>
            <span class="favorites-count" id="favoritesCountMobile">0</span>
        </button>
        <button class="dark-mode-toggle" onclick="toggleDarkMode()">
            <span id="darkModeIconMobile">üåô</span>
            <span id="darkModeTextMobile">Dark</span>
        </button>
    </div>
    
    <!-- Favorites Modal -->
    <div id="favoritesModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚≠ê My Favorites</h2>
                <button class="modal-close" onclick="toggleFavoritesModal()">√ó</button>
            </div>
            <div id="favoritesList">
                <p style="text-align: center; color: var(--text-secondary); padding: 40px;">
                    No favorites yet! Click the ‚≠ê button on any stock to add it.
                </p>
            </div>
        </div>
    </div>
    
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
    <script>
        let isScanning = false;
        
        // ===== DARK MODE =====
        function toggleDarkMode() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            
            // Update both desktop and mobile buttons
            const icons = [document.getElementById('darkModeIcon'), document.getElementById('darkModeIconMobile')];
            const texts = [document.getElementById('darkModeText'), document.getElementById('darkModeTextMobile')];
            
            icons.forEach(icon => {
                if (icon) {
                    icon.textContent = newTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
                }
            });
            
            texts.forEach(text => {
                if (text) {
                    text.textContent = newTheme === 'dark' ? 'Light' : 'Dark';
                }
            });
        }
        
        // Load saved theme on page load
        document.addEventListener('DOMContentLoaded', function() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            
            if (savedTheme === 'dark') {
                const icons = [document.getElementById('darkModeIcon'), document.getElementById('darkModeIconMobile')];
                const texts = [document.getElementById('darkModeText'), document.getElementById('darkModeTextMobile')];
                
                icons.forEach(icon => {
                    if (icon) icon.textContent = '‚òÄÔ∏è';
                });
                
                texts.forEach(text => {
                    if (text) text.textContent = 'Light';
                });
            }
            
            updateFavoritesCount();
            loadHistoricalData();
        });
        
        // ===== FAVORITES SYSTEM =====
        function getFavorites() {
            const favorites = localStorage.getItem('lemonFavorites');
            return favorites ? JSON.parse(favorites) : [];
        }
        
        function saveFavorites(favorites) {
            localStorage.setItem('lemonFavorites', JSON.stringify(favorites));
            updateFavoritesCount();
        }
        
        function addToFavorites(ticker, company, timeframe = 'daily') {
            const favorites = getFavorites();
            const exists = favorites.find(f => f.ticker === ticker && f.timeframe === timeframe);
            
            if (!exists) {
                favorites.push({
                    ticker,
                    company,
                    timeframe,
                    addedAt: new Date().toISOString()
                });
                saveFavorites(favorites);
                alert(`‚úÖ ${ticker} added to favorites!`);
            } else {
                alert(`‚ÑπÔ∏è ${ticker} is already in favorites`);
            }
        }
        
        function removeFromFavorites(ticker, timeframe) {
            let favorites = getFavorites();
            favorites = favorites.filter(f => !(f.ticker === ticker && f.timeframe === timeframe));
            saveFavorites(favorites);
            displayFavorites();
        }
        
        function updateFavoritesCount() {
            const count = getFavorites().length;
            // Update both desktop and mobile counters
            const desktopCounter = document.getElementById('favoritesCount');
            const mobileCounter = document.getElementById('favoritesCountMobile');
            
            if (desktopCounter) desktopCounter.textContent = count;
            if (mobileCounter) mobileCounter.textContent = count;
        }
        
        function toggleFavoritesModal() {
            const modal = document.getElementById('favoritesModal');
            const isActive = modal.classList.contains('active');
            
            if (isActive) {
                modal.classList.remove('active');
            } else {
                modal.classList.add('active');
                displayFavorites();
            }
        }
        
        function displayFavorites() {
            const favorites = getFavorites();
            const container = document.getElementById('favoritesList');
            
            if (favorites.length === 0) {
                container.innerHTML = `
                    <p style="text-align: center; color: var(--text-secondary); padding: 40px;">
                        No favorites yet! Click the ‚≠ê button on any stock to add it.
                    </p>
                `;
                return;
            }
            
            let html = '';
            favorites.forEach(fav => {
                const winRate = getWinRate(fav.ticker, fav.timeframe);
                html += `
                    <div class="favorite-item">
                        <div class="favorite-info">
                            <div class="favorite-ticker">
                                ${fav.ticker}
                                ${winRate.badge}
                            </div>
                            <div class="favorite-meta">
                                ${fav.company} ‚Ä¢ ${fav.timeframe} ‚Ä¢ Added ${new Date(fav.addedAt).toLocaleDateString()}
                            </div>
                        </div>
                        <div class="favorite-actions">
                            <button class="favorite-scan-btn" onclick="scanFavorite('${fav.ticker}', '${fav.timeframe}')">
                                üîç Scan
                            </button>
                            <button class="favorite-remove-btn" onclick="removeFromFavorites('${fav.ticker}', '${fav.timeframe}')">
                                üóëÔ∏è
                            </button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function scanFavorite(ticker, timeframe) {
            // Close modal and switch to appropriate tab
            toggleFavoritesModal();
            
            // Switch to the right tab
            if (timeframe === 'hourly') {
                switchTab('hourly');
                startHourlyScan();
            } else if (timeframe === 'daily') {
                switchTab('daily');
                startDailyScan();
            } else if (timeframe === 'weekly') {
                switchTab('weekly');
                startWeeklyScan();
            } else if (timeframe === 'crypto') {
                switchTab('crypto');
                startCryptoScan();
            }
        }
        
        // ===== HISTORICAL WIN RATE TRACKING =====
        function getHistoricalData() {
            const data = localStorage.getItem('lemonHistorical');
            return data ? JSON.parse(data) : [];
        }
        
        function saveHistoricalData(data) {
            localStorage.setItem('lemonHistorical', JSON.stringify(data));
        }
        
        function trackPattern(ticker, timeframe, direction, currentPrice, patternDate) {
            const historical = getHistoricalData();
            
            historical.push({
                ticker,
                timeframe,
                direction,
                entryPrice: currentPrice,
                patternDate: patternDate,
                recordedAt: new Date().toISOString(),
                outcome: 'pending'
            });
            
            saveHistoricalData(historical);
        }
        
        async function loadHistoricalData() {
            // Check patterns after 7 days to see if they were successful
            const historical = getHistoricalData();
            const now = new Date();
            
            for (let pattern of historical) {
                if (pattern.outcome === 'pending') {
                    const recordedDate = new Date(pattern.recordedAt);
                    const daysSince = (now - recordedDate) / (1000 * 60 * 60 * 24);
                    
                    // Check after 7 days
                    if (daysSince >= 7) {
                        try {
                            const ticker = pattern.ticker.includes('-') ? pattern.ticker : pattern.ticker;
                            const stock = yf.Ticker(ticker);
                            const hist = await fetch(`https://query1.finance.yahoo.com/v8/finance/chart/${ticker}?interval=1d&range=1mo`);
                            const data = await hist.json();
                            
                            if (data && data.chart && data.chart.result[0]) {
                                const prices = data.chart.result[0].indicators.quote[0].close;
                                const currentPrice = prices[prices.length - 1];
                                const priceChange = ((currentPrice - pattern.entryPrice) / pattern.entryPrice) * 100;
                                
                                // Consider it a win if:
                                // - Bullish pattern and price went up 3%+
                                // - Bearish pattern and price went down 3%+
                                if (pattern.direction === 'bullish' && priceChange >= 3) {
                                    pattern.outcome = 'win';
                                    pattern.exitPrice = currentPrice;
                                    pattern.profitPercent = priceChange;
                                } else if (pattern.direction === 'bearish' && priceChange <= -3) {
                                    pattern.outcome = 'win';
                                    pattern.exitPrice = currentPrice;
                                    pattern.profitPercent = Math.abs(priceChange);
                                } else if (Math.abs(priceChange) < 3) {
                                    pattern.outcome = 'neutral';
                                } else {
                                    pattern.outcome = 'loss';
                                    pattern.exitPrice = currentPrice;
                                    pattern.profitPercent = priceChange;
                                }
                            }
                        } catch (e) {
                            console.error(`Error checking ${pattern.ticker}:`, e);
                        }
                    }
                }
            }
            
            saveHistoricalData(historical);
        }
        
        function getWinRate(ticker, timeframe) {
            const historical = getHistoricalData();
            const patterns = historical.filter(p => 
                p.ticker === ticker && 
                p.timeframe === timeframe &&
                p.outcome !== 'pending'
            );
            
            if (patterns.length === 0) {
                return {
                    rate: null,
                    badge: '<span class="win-rate-badge win-rate-new">NEW</span>'
                };
            }
            
            const wins = patterns.filter(p => p.outcome === 'win').length;
            const rate = (wins / patterns.length * 100).toFixed(0);
            
            let badgeClass = 'win-rate-medium';
            if (rate >= 70) badgeClass = 'win-rate-high';
            else if (rate < 50) badgeClass = 'win-rate-low';
            
            return {
                rate: rate,
                badge: `<span class="win-rate-badge ${badgeClass}">${rate}% Win (${wins}/${patterns.length})</span>`
            };
        }
        
        // ===== CHART INTEGRATION =====
        function createChart(containerId, ticker, timeframe = 'daily') {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            // Map timeframe to TradingView interval
            const intervalMap = {
                'hourly': '60',
                'daily': 'D',
                'weekly': 'W',
                'crypto': 'D'
            };
            
            const interval = intervalMap[timeframe] || 'D';
            const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'light';
            
            // For crypto, use the format expected by TradingView
            const symbol = ticker.includes('-USD') ? `CRYPTO:${ticker.replace('-USD', 'USD')}` : ticker;
            
            container.innerHTML = `
                <iframe 
                    src="https://s.tradingview.com/widgetembed/?frameElementId=tradingview_chart&symbol=${symbol}&interval=${interval}&hidesidetoolbar=0&symboledit=1&saveimage=1&toolbarbg=f1f3f6&studies=[]&theme=${theme}&style=1&timezone=Etc%2FUTC&withdateranges=1&showpopupbutton=1&studies_overrides={}&overrides={}&enabled_features=[]&disabled_features=[]&showpopupbutton=1&popup_height=650&popup_width=1000&locale=en"
                    style="width: 100%; height: 100%; margin: 0; padding: 0; border: none;"
                    frameborder="0"
                    allowtransparency="true"
                    scrolling="no"
                ></iframe>
            `;
        }
        
        // Tab switching
        function switchTab(tab) {
            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            if (tab === 'squeeze') {
                document.getElementById('squeezeTab').classList.add('active');
            } else if (tab === 'findaplay') {
                document.getElementById('findaplayTab').classList.add('active');
            } else if (tab === 'crypto') {
                document.getElementById('cryptoTab').classList.add('active');
            } else if (tab === 'volemon') {
                document.getElementById('volemonTab').classList.add('active');
            } else if (tab === 'usuals') {
                document.getElementById('usualsTab').classList.add('active');
            }
        }
        
        // Short Squeeze Scanner
        async function startSqueezeScan() {
            if (isScanning) return;
            
            const minShort = parseFloat(document.getElementById('minShort').value);
            const minGain = parseFloat(document.getElementById('minGain').value);
            const minVolRatio = parseFloat(document.getElementById('minVolRatio').value);
            const minRisk = parseFloat(document.getElementById('minRisk').value);
            
            if (isNaN(minShort) || isNaN(minGain) || isNaN(minVolRatio) || isNaN(minRisk)) {
                alert('Please enter valid numbers!');
                return;
            }
            
            isScanning = true;
            document.getElementById('scanButton').disabled = true;
            document.getElementById('scanButton').textContent = '‚è≥ SCANNING...';
            document.getElementById('squeezeLoading').classList.add('active');
            document.getElementById('squeezeResults').classList.remove('active');
            
            try {
                const response = await fetch('/api/scan', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        minShort,
                        minGain,
                        minVolRatio,
                        minRisk
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    displaySqueezeResults(data.results, minShort, minGain, minVolRatio, minRisk);
                } else {
                    alert('Error: ' + data.error);
                }
                
            } catch (error) {
                alert('Error scanning: ' + error.message);
            } finally {
                isScanning = false;
                document.getElementById('scanButton').disabled = false;
                document.getElementById('scanButton').textContent = 'üîç SCAN FOR SQUEEZES üçã';
                document.getElementById('squeezeLoading').classList.remove('active');
            }
        }
        
        function displaySqueezeResults(candidates, minShort, minGain, minVolRatio, minRisk) {
            const resultsDiv = document.getElementById('squeezeResults');
            resultsDiv.classList.add('active');
            
            if (candidates.length === 0) {
                resultsDiv.innerHTML = `
                    <div class="no-results">
                        <h3>üçã No Squeezes Found Today</h3>
                        <p style="font-size: 1.2em; color: #666; margin: 20px 0;">
                            No stocks met the criteria: Short Interest ‚â•${minShort}% AND Daily Gain ‚â•+${minGain}%
                        </p>
                        <p style="color: #999;">
                            üí° Try lowering the thresholds or check back later!<br>
                            The market might just be having a calm day.
                        </p>
                    </div>
                `;
                return;
            }
            
            const avgGain = candidates.reduce((sum, s) => sum + s.dailyChange, 0) / candidates.length;
            const maxGain = Math.max(...candidates.map(s => s.dailyChange));
            const avgShort = candidates.reduce((sum, s) => sum + s.shortInterest, 0) / candidates.length;
            const avgRisk = candidates.reduce((sum, s) => sum + s.riskScore, 0) / candidates.length;
            
            let html = `
                <div class="results-header">
                    <h2>üöÄ Squeeze Candidates Found!</h2>
                    <p style="font-size: 1.2em; color: #666; margin: 10px 0;">
                        ${new Date().toLocaleString()}
                    </p>
                    <div class="summary-stats">
                        <div class="stat">
                            <span class="stat-value">${candidates.length}</span>
                            <span class="stat-label">Candidates</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value">${avgRisk.toFixed(1)}</span>
                            <span class="stat-label">Avg Risk Score</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value">+${avgGain.toFixed(2)}%</span>
                            <span class="stat-label">Avg Gain</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value">+${maxGain.toFixed(2)}%</span>
                            <span class="stat-label">Max Gain</span>
                        </div>
                    </div>
                </div>
            `;
            
            candidates.forEach((stock, idx) => {
                let riskClass, riskLabel, riskEmoji;
                if (stock.riskScore >= 90) {
                    riskClass = 'risk-extreme';
                    riskLabel = 'EXTREME';
                    riskEmoji = 'üî•üî•üî•';
                } else if (stock.riskScore >= 80) {
                    riskClass = 'risk-high';
                    riskLabel = 'HIGH';
                    riskEmoji = 'üöÄüöÄ';
                } else if (stock.riskScore >= 70) {
                    riskClass = 'risk-good';
                    riskLabel = 'GOOD';
                    riskEmoji = 'üí™';
                } else {
                    riskClass = 'risk-moderate';
                    riskLabel = 'MODERATE';
                    riskEmoji = '‚úÖ';
                }
                
                html += `
                    <div class="stock-card">
                        <div class="stock-header">
                            <div class="stock-title-row">
                                <button class="favorite-btn" onclick="addToFavorites('${stock.ticker}', '${stock.company}', 'squeeze')" title="Add to favorites">
                                    ‚≠ê
                                </button>
                                <div class="stock-ticker">#${idx + 1}. ${stock.ticker}</div>
                            </div>
                            <div class="risk-badge ${riskClass}">
                                ${stock.riskScore}/100 ${riskEmoji}
                            </div>
                        </div>
                        <div class="stock-company">${stock.company}</div>
                        
                        <div class="metrics-grid">
                            <div class="metric-section">
                                <h4>üìä Core Metrics</h4>
                                <div class="metric-item">
                                    <span class="metric-label">Short Interest:</span>
                                    <span class="metric-value">${stock.shortInterest.toFixed(2)}%</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Daily Gain:</span>
                                    <span class="metric-value" style="color: #10b981;">+${stock.dailyChange.toFixed(2)}%</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Price Move:</span>
                                    <span class="metric-value">$${stock.previousClose.toFixed(2)} ‚Üí $${stock.currentPrice.toFixed(2)}</span>
                                </div>
                            </div>
                            
                            <div class="metric-section">
                                <h4>üìà Volume Analysis</h4>
                                <div class="metric-item">
                                    <span class="metric-label">Current Vol:</span>
                                    <span class="metric-value">${stock.volume.toLocaleString()}</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Avg Volume:</span>
                                    <span class="metric-value">${stock.avgVolume.toLocaleString()}</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Volume Ratio:</span>
                                    <span class="metric-value">${stock.volumeRatio.toFixed(2)}x ${stock.volumeRatio >= 3 ? 'üî•' : stock.volumeRatio >= 2 ? 'üöÄ' : '‚úÖ'}</span>
                                </div>
                            </div>
                            
                            <div class="metric-section">
                                <h4>‚öôÔ∏è Squeeze Mechanics</h4>
                                <div class="metric-item">
                                    <span class="metric-label">Float:</span>
                                    <span class="metric-value">${(stock.floatShares / 1000000).toFixed(1)}M</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Days to Cover:</span>
                                    <span class="metric-value">${stock.daysToCover.toFixed(2)} ${stock.daysToCover >= 5 ? 'üöÄ' : '‚úÖ'}</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Market Cap:</span>
                                    <span class="metric-value">$${(stock.marketCap / 1000000).toFixed(1)}M</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="chart-container" id="chart-${stock.ticker}-squeeze-${idx}"></div>
                    </div>
                `;
            });
            
            resultsDiv.innerHTML = html;
            
            // Create charts after HTML is rendered
            candidates.forEach((stock, idx) => {
                setTimeout(() => createChart(`chart-${stock.ticker}-squeeze-${idx}`, stock.ticker, 'daily'), 200 + (idx * 100));
            });
        }
        
        // Find A Play Scanner (Multi-Timeframe)
        async function startFindAPlayScan() {
            if (isScanning) return;
            
            isScanning = true;
            const button = document.getElementById('findaplayButton');
            button.disabled = true;
            button.textContent = 'üéØ SCANNING...';
            document.getElementById('findaplayLoading').classList.add('active');
            document.getElementById('findaplayResults').classList.remove('active');
            
            try {
                const response = await fetch('/api/find-a-play', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({})
                });
                
                const data = await response.json();
                
                if (data.success) {
                    displayFindAPlayResults(data.results, data.stats);
                } else {
                    alert('Error: ' + data.error);
                }
                
            } catch (error) {
                alert('Error scanning: ' + error.message);
                console.error('Find A Play scan error:', error);
            } finally {
                isScanning = false;
                button.disabled = false;
                button.textContent = 'üéØ FIND A PLAY - SCAN ALL TIMEFRAMES! üçã';
                document.getElementById('findaplayLoading').classList.remove('active');
            }
        }
        
        function displayFindAPlayResults(plays, stats) {
            const resultsDiv = document.getElementById('findaplayResults');
            resultsDiv.classList.add('active');
            
            if (plays.length === 0) {
                resultsDiv.innerHTML = `
                    <div class="no-results">
                        <h3>üéØ No Patterns Found</h3>
                        <p>No 3-1 Strat patterns or inside bars detected across any timeframes right now.</p>
                        <p>Try again later or adjust your watchlist!</p>
                    </div>
                `;
                return;
            }
            
            let html = `
                <div class="results-header">
                    <h2>üéØ ${plays.length} Plays Found!</h2>
                    <div class="summary-stats">
                        <div class="stat">
                            <span class="stat-value">${stats.total_scanned}</span>
                            <span class="stat-label">Stocks Scanned</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value" style="color: #10b981;">${stats.three_star}</span>
                            <span class="stat-label">‚≠ê‚≠ê‚≠ê Plays</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value" style="color: #fbbf24;">${stats.two_star}</span>
                            <span class="stat-label">‚≠ê‚≠ê Plays</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value" style="color: #94a3b8;">${stats.one_star}</span>
                            <span class="stat-label">‚≠ê Plays</span>
                        </div>
                    </div>
                    <p style="margin-top: 15px; font-size: 0.95em; color: var(--text-secondary);">
                        üí° <strong>Tip:</strong> ‚≠ê‚≠ê‚≠ê plays have patterns on ALL timeframes - these are the strongest signals!
                    </p>
                </div>
                
                <table class="timeframe-table">
                    <thead>
                        <tr>
                            <th>Strength</th>
                            <th>Ticker</th>
                            <th>Company</th>
                            <th>Price</th>
                            <th>Change</th>
                            <th>Daily</th>
                            <th>Weekly</th>
                            <th>Hourly</th>
                            <th>Volume</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            plays.forEach(play => {
                const strengthClass = `strength-${play.strength}`;
                const stars = '‚≠ê'.repeat(play.strength);
                const changeClass = play.dailyChange >= 0 ? 'price-positive' : 'price-negative';
                
                html += `
                    <tr>
                        <td><span class="strength-badge ${strengthClass}">${stars}</span></td>
                        <td><strong style="font-size: 1.1em;">${play.ticker}</strong></td>
                        <td style="font-size: 0.9em; color: var(--text-secondary);">${play.company}</td>
                        <td><strong>$${play.currentPrice.toFixed(2)}</strong></td>
                        <td class="${changeClass}"><strong>${play.dailyChange >= 0 ? '+' : ''}${play.dailyChange.toFixed(2)}%</strong></td>
                        <td>${formatPattern(play.patterns.daily)}</td>
                        <td>${formatPattern(play.patterns.weekly)}</td>
                        <td>${formatPattern(play.patterns.hourly)}</td>
                        <td style="font-size: 0.95em;">${(play.volume / 1000000).toFixed(1)}M</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            
            resultsDiv.innerHTML = html;
        }
        
        function formatPattern(pattern) {
            if (!pattern) {
                return '<span class="pattern-none">-</span>';
            }
            
            const type = pattern.type;
            const direction = pattern.direction;
            
            // 3-1 Pattern
            if (type === '3-1') {
                const arrow = direction === 'bullish' ? '‚Üë' : '‚Üì';
                const patternClass = direction === 'bullish' ? 'pattern-bullish' : 'pattern-bearish';
                return `<span class="pattern-indicator ${patternClass}">3-1 ${arrow}</span>`;
            }
            
            // Inside Bar
            if (type === 'Inside') {
                const arrow = direction === 'bullish' ? '‚Üë' : '‚Üì';
                return `<span class="pattern-indicator pattern-neutral">Inside ${arrow}</span>`;
            }
            
            // Fallback
            return '<span class="pattern-none">-</span>';
        }
        
        // Crypto Scanner
        async function startCryptoScan() {
            if (isScanning) return;
            
            isScanning = true;
            document.getElementById('cryptoButton').disabled = true;
            document.getElementById('cryptoButton').textContent = '‚è≥ SCANNING...';
            document.getElementById('cryptoLoading').classList.add('active');
            document.getElementById('cryptoResults').classList.remove('active');
            
            try {
                const response = await fetch('/api/crypto-plays', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({})
                });
                
                const data = await response.json();
                
                if (data.success) {
                    displayCryptoResults(data.results);
                } else {
                    alert('Error: ' + data.error);
                }
                
            } catch (error) {
                alert('Error scanning: ' + error.message);
                console.error('Crypto scan error:', error);
            } finally {
                isScanning = false;
                document.getElementById('cryptoButton').disabled = false;
                document.getElementById('cryptoButton').textContent = '‚Çø SCAN CRYPTO PATTERNS üöÄ';
                document.getElementById('cryptoLoading').classList.remove('active');
            }
        }
        
        function displayCryptoResults(patterns) {
            const resultsDiv = document.getElementById('cryptoResults');
            resultsDiv.classList.add('active');
            
            if (patterns.length === 0) {
                resultsDiv.innerHTML = `
                    <div class="no-results">
                        <h3>‚Çø No Crypto Patterns Found</h3>
                        <p style="font-size: 1.2em; color: #666; margin: 20px 0;">
                            No 3-1 Strat patterns found in BTC, ETH, XRP, SOL, DOGE, HYPE
                        </p>
                        <p style="color: #999;">
                            üí° Crypto patterns can form quickly - check back soon!
                        </p>
                    </div>
                `;
                return;
            }
            
            // Group by crypto
            const grouped = {};
            patterns.forEach(p => {
                if (!grouped[p.ticker]) grouped[p.ticker] = [];
                grouped[p.ticker].push(p);
            });
            
            let html = `
                <div class="results-header">
                    <h2>‚Çø Crypto 3-1 Strat Patterns Found!</h2>
                    <p style="font-size: 1.2em; color: #666; margin: 10px 0;">
                        ${new Date().toLocaleString()}
                    </p>
                    <div class="summary-stats">
                        <div class="stat">
                            <span class="stat-value">${patterns.length}</span>
                            <span class="stat-label">Total Patterns</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value">${Object.keys(grouped).length}</span>
                            <span class="stat-label">Cryptos</span>
                        </div>
                    </div>
                </div>
            `;
            
            patterns.forEach((crypto, idx) => {
                const pattern = crypto.pattern;
                const patternClass = pattern.direction === 'bullish' ? 'pattern-bullish' : 'pattern-bearish';
                const patternEmoji = pattern.direction === 'bullish' ? 'üìà' : 'üìâ';
                
                html += `
                    <div class="pattern-card">
                        <div class="stock-header">
                            <div class="stock-title-row">
                                <button class="favorite-btn" onclick="addToFavorites('${crypto.ticker}', '${crypto.company}', 'crypto')" title="Add to favorites">
                                    ‚≠ê
                                </button>
                                <div class="stock-ticker">#${idx + 1}. ${crypto.ticker}</div>
                            </div>
                            <div class="pattern-badge ${patternClass}">
                                ${patternEmoji} ${pattern.direction.toUpperCase()} (${crypto.timeframe.toUpperCase()})
                            </div>
                        </div>
                        <div class="stock-company">${crypto.company}</div>
                        
                        <div class="pattern-info">
                            <h4 style="color: #FFA500; margin-bottom: 10px;">‚Çø ${crypto.timeframe} Pattern Details</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <strong style="color: #666;">3Ô∏è‚É£ Outside Bar (${pattern.three_candle.date}):</strong><br>
                                    High: $${pattern.three_candle.high.toFixed(2)}<br>
                                    Low: $${pattern.three_candle.low.toFixed(2)}<br>
                                    Close: $${pattern.three_candle.close.toFixed(2)}
                                </div>
                                <div>
                                    <strong style="color: #666;">1Ô∏è‚É£ Inside Bar (${pattern.one_candle.date}):</strong><br>
                                    High: $${pattern.one_candle.high.toFixed(2)}<br>
                                    Low: $${pattern.one_candle.low.toFixed(2)}<br>
                                    Open: $${pattern.one_candle.open.toFixed(2)}<br>
                                    Close: $${pattern.one_candle.close.toFixed(2)}
                                </div>
                            </div>
                            <div style="background: white; padding: 10px; border-radius: 5px; margin-top: 10px;">
                                <strong>üí° Interpretation:</strong> 
                                ${crypto.timeframe} crypto pattern! ${pattern.direction.charAt(0).toUpperCase() + pattern.direction.slice(1)} setup 
                                suggests potential breakout ${pattern.direction === 'bullish' ? 'above' : 'below'} the consolidation range.
                                ${crypto.timeframe === 'Weekly' ? 'Weekly patterns can signal major multi-week moves!' : ''}
                            </div>
                        </div>
                        
                        <div class="metrics-grid" style="margin-top: 20px;">
                            <div class="metric-section">
                                <h4>üí∞ Price Info</h4>
                                <div class="metric-item">
                                    <span class="metric-label">Current Price:</span>
                                    <span class="metric-value">$${crypto.currentPrice.toFixed(2)}</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">${crypto.timeframe} Change:</span>
                                    <span class="metric-value" style="color: ${crypto.change >= 0 ? '#10b981' : '#ef4444'};">
                                        ${crypto.change >= 0 ? '+' : ''}${crypto.change.toFixed(2)}%
                                    </span>
                                </div>
                                ${crypto.marketCap > 0 ? `
                                <div class="metric-item">
                                    <span class="metric-label">Market Cap:</span>
                                    <span class="metric-value">$${(crypto.marketCap / 1000000000).toFixed(2)}B</span>
                                </div>
                                ` : ''}
                            </div>
                            
                            <div class="metric-section">
                                <h4>üìä Volume Info</h4>
                                <div class="metric-item">
                                    <span class="metric-label">Current Vol:</span>
                                    <span class="metric-value">${crypto.volume.toLocaleString()}</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Avg Volume:</span>
                                    <span class="metric-value">${crypto.avgVolume.toLocaleString()}</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="chart-container" id="chart-${crypto.ticker}-crypto-${idx}"></div>
                    </div>
                `;
            });
            
            resultsDiv.innerHTML = html;
            
            // Create charts after HTML is rendered
            patterns.forEach((crypto, idx) => {
                setTimeout(() => createChart(`chart-${crypto.ticker}-crypto-${idx}`, crypto.fullTicker, 'crypto'), 200 + (idx * 100));
            });
        }
        
        // ===== VOLEMON AUTO-SCANNER =====
        let volemonInterval = null;
        let volemonCountdown = null;
        let volemonTimeLeft = 20 * 60; // 20 minutes in seconds
        let volemonStats = {
            totalScans: 0,
            lastScan: null,
            stocksFoundToday: 0
        };
        
        // Store all stocks found today
        let volemonStocksFound = [];

        // Load volemon stats from localStorage
        function loadVolemonStats() {
            const saved = localStorage.getItem('volemonStats');
            if (saved) {
                const data = JSON.parse(saved);
                const today = new Date().toDateString();
                if (data.date === today) {
                    volemonStats = data.stats;
                    volemonStocksFound = data.stocksFound || [];
                    updateVolemonStatsDisplay();
                    // Display any saved stocks from today
                    if (volemonStocksFound.length > 0) {
                        displayVolemonResults(volemonStocksFound, true);
                    }
                }
            }
        }

        function saveVolemonStats() {
            localStorage.setItem('volemonStats', JSON.stringify({
                date: new Date().toDateString(),
                stats: volemonStats,
                stocksFound: volemonStocksFound
            }));
        }

        function updateVolemonStatsDisplay() {
            document.getElementById('totalScans').textContent = volemonStats.totalScans;
            document.getElementById('lastScan').textContent = volemonStats.lastScan || 'Never';
            document.getElementById('stocksFound').textContent = volemonStocksFound.length;
        }

        function updateVolemonTimer() {
            const minutes = Math.floor(volemonTimeLeft / 60);
            const seconds = volemonTimeLeft % 60;
            const timerElement = document.getElementById('volemonTimer');
            if (timerElement) {
                timerElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }
        }

        function startVolemonCountdown() {
            if (volemonCountdown) clearInterval(volemonCountdown);
            
            volemonCountdown = setInterval(() => {
                volemonTimeLeft--;
                if (volemonTimeLeft < 0) {
                    volemonTimeLeft = 20 * 60;
                }
                updateVolemonTimer();
            }, 1000);
        }

        async function performVolemonScan() {
            console.log('üîä Volemon scanning...');
            
            const loadingDiv = document.getElementById('volemonLoading');
            const resultsDiv = document.getElementById('volemonResults');
            
            loadingDiv.classList.add('active');
            
            try {
                const response = await fetch('/api/volemon-scan', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ min_volume_multiple: 2.0 })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    volemonStats.totalScans++;
                    volemonStats.lastScan = new Date().toLocaleTimeString();
                    
                    // Add scan timestamp to each stock
                    const timestamp = new Date().toLocaleTimeString();
                    const newStocks = data.results.map(stock => ({
                        ...stock,
                        foundAt: timestamp,
                        scanNumber: volemonStats.totalScans
                    }));
                    
                    // Add new stocks to the collection (avoid duplicates from same scan)
                    newStocks.forEach(newStock => {
                        const existingIndex = volemonStocksFound.findIndex(
                            s => s.ticker === newStock.ticker && s.scanNumber === newStock.scanNumber
                        );
                        if (existingIndex === -1) {
                            volemonStocksFound.unshift(newStock); // Add to beginning
                        }
                    });
                    
                    saveVolemonStats();
                    updateVolemonStatsDisplay();
                    displayVolemonResults(volemonStocksFound, false);
                }
            } catch (error) {
                console.error('Volemon scan error:', error);
            } finally {
                loadingDiv.classList.remove('active');
            }
        }

        function displayVolemonResults(stocks, isLoadingFromCache = false) {
            const resultsDiv = document.getElementById('volemonResults');
            resultsDiv.classList.add('active');
            
            if (stocks.length === 0) {
                resultsDiv.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px; background: var(--card-bg); border-radius: 15px; margin-top: 20px;">
                        <h3 style="font-size: 1.8em; margin-bottom: 15px;">üîä No Volume Spikes Found Yet</h3>
                        <p style="font-size: 1.1em; color: var(--text-secondary);">
                            Volemon is actively scanning every 20 minutes.
                        </p>
                        <p style="color: var(--text-secondary); opacity: 0.8; margin-top: 15px;">
                            üí° Stocks will appear here when volume spikes are detected!
                        </p>
                    </div>
                `;
                return;
            }
            
            // Group stocks by scan
            const stocksByScan = {};
            stocks.forEach(stock => {
                const scanKey = stock.scanNumber || 'Unknown';
                if (!stocksByScan[scanKey]) {
                    stocksByScan[scanKey] = [];
                }
                stocksByScan[scanKey].push(stock);
            });
            
            // Get unique count (avoid counting same stock multiple times)
            const uniqueTickers = [...new Set(stocks.map(s => s.ticker))];
            
            let html = `
                <div class="results-header">
                    <h2>üîä Volemon - Volume Monsters Detected Today!</h2>
                    <p style="opacity: 0.8; margin-top: 10px;">
                        ${isLoadingFromCache ? 'Showing stocks found today' : 'Updated: ' + new Date().toLocaleString()}
                    </p>
                    <div class="stats-grid" style="margin-top: 20px;">
                        <div class="stat-item">
                            <span class="stat-value">${uniqueTickers.length}</span>
                            <span class="stat-label">Unique Stocks</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value">${stocks.filter(s => s.volume_multiple >= 3).length}</span>
                            <span class="stat-label">3x+ Volume</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value">${stocks.length}</span>
                            <span class="stat-label">Total Detections</span>
                        </div>
                    </div>
                    ${!isLoadingFromCache ? `
                        <div style="margin-top: 15px; padding: 12px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-radius: 10px; color: white; text-align: center; font-weight: bold;">
                            ‚ú® Latest scan completed! Scroll down to see newest results.
                        </div>
                    ` : ''}
                </div>
            `;
            
            stocks.forEach((stock, idx) => {
                const volColor = stock.volume_multiple >= 3 ? '#10b981' : '#8b5cf6';
                const isRecent = idx < 10 && !isLoadingFromCache; // Highlight recent finds
                
                html += `
                    <div class="stock-card" style="${isRecent ? 'border: 3px solid #10b981; animation: pulse 2s infinite;' : ''}">
                        <div class="stock-header">
                            <div class="header-left">
                                <button class="favorite-btn" onclick="addToFavorites('${stock.ticker}', '${stock.company}', 'volemon')" title="Add to favorites">
                                    ‚≠ê
                                </button>
                                <div>
                                    <div class="stock-ticker">
                                        ${isRecent ? 'üÜï ' : ''}#${idx + 1}. ${stock.ticker}
                                    </div>
                                    <div class="stock-company">${stock.company}</div>
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <div class="badge" style="background: ${volColor}; color: white; padding: 8px 16px; border-radius: 25px; font-weight: bold; margin-bottom: 5px;">
                                    üîä ${stock.volume_multiple.toFixed(1)}x Volume
                                </div>
                                <div style="font-size: 0.85em; color: var(--text-secondary); opacity: 0.8;">
                                    Found: ${stock.foundAt || 'Earlier today'} ${stock.scanNumber ? `(Scan #${stock.scanNumber})` : ''}
                                </div>
                            </div>
                        </div>
                        
                        <div class="metrics-grid">
                            <div class="metric-section">
                                <h4>üí∞ Price Info</h4>
                                <div class="metric-item">
                                    <span class="metric-label">Price:</span>
                                    <span class="metric-value">$${stock.price.toFixed(2)}</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Change:</span>
                                    <span class="metric-value" style="color: ${stock.change >= 0 ? '#10b981' : '#ef4444'};">
                                        ${stock.change >= 0 ? '+' : ''}${stock.change.toFixed(2)}%
                                    </span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Market Cap:</span>
                                    <span class="metric-value">$${(stock.market_cap / 1000000).toFixed(1)}M</span>
                                </div>
                            </div>
                            
                            <div class="metric-section">
                                <h4>üìä Volume Info</h4>
                                <div class="metric-item">
                                    <span class="metric-label">Current Vol:</span>
                                    <span class="metric-value">${stock.volume.toLocaleString()}</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Avg Vol:</span>
                                    <span class="metric-value">${stock.avg_volume.toLocaleString()}</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Multiple:</span>
                                    <span class="metric-value" style="color: ${volColor}; font-weight: bold;">
                                        ${stock.volume_multiple.toFixed(2)}x
                                    </span>
                                </div>
                            </div>
                        </div>
                        
                        <div style="background: var(--settings-bg); padding: 15px; border-radius: 10px; margin-top: 15px;">
                            <strong style="color: #8b5cf6;">üîä Volume Analysis:</strong>
                            <p style="margin-top: 8px; color: var(--text-secondary);">
                                ${stock.ticker} was detected at <strong>${stock.volume_multiple.toFixed(1)}x</strong> its average volume at ${stock.foundAt || 'earlier today'}!
                                ${stock.volume_multiple >= 3 
                                    ? 'This is a significant spike that could indicate strong institutional or retail interest.' 
                                    : 'Increased volume may signal growing momentum or news-driven activity.'}
                            </p>
                        </div>
                        
                        <div class="chart-container" id="chart-${stock.ticker}-volemon-${idx}"></div>
                    </div>
                `;
            });
            
            resultsDiv.innerHTML = html;
            
            // Create charts
            stocks.forEach((stock, idx) => {
                setTimeout(() => createChart(`chart-${stock.ticker}-volemon-${idx}`, stock.ticker, 'daily'), 200 + (idx * 100));
            });
        }
        
        function clearVolemonResults() {
            if (confirm('Are you sure you want to clear all Volemon results? They will start accumulating again from the next scan.')) {
                volemonStocksFound = [];
                saveVolemonStats();
                updateVolemonStatsDisplay();
                
                const resultsDiv = document.getElementById('volemonResults');
                resultsDiv.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px; background: var(--card-bg); border-radius: 15px; margin-top: 20px;">
                        <h3 style="font-size: 1.8em; margin-bottom: 15px;">üîä Results Cleared!</h3>
                        <p style="font-size: 1.1em; color: var(--text-secondary);">
                            Volemon is still actively scanning every 20 minutes.
                        </p>
                        <p style="color: var(--text-secondary); opacity: 0.8; margin-top: 15px;">
                            üí° New stocks will appear here as they're detected!
                        </p>
                    </div>
                `;
            }
        }

        // Start Volemon on page load
        function startVolemonAutoScanner() {
            console.log('üîä Starting Volemon auto-scanner...');
            loadVolemonStats();
            
            // Initial scan
            performVolemonScan();
            
            // Set up 20-minute interval
            volemonInterval = setInterval(() => {
                performVolemonScan();
                volemonTimeLeft = 20 * 60;
            }, 20 * 60 * 1000);
            
            // Start countdown
            startVolemonCountdown();
        }

        // Initialize Volemon when page loads
        window.addEventListener('DOMContentLoaded', () => {
            startVolemonAutoScanner();
        });

        // Cleanup on unload
        window.addEventListener('beforeunload', () => {
            if (volemonInterval) clearInterval(volemonInterval);
            if (volemonCountdown) clearInterval(volemonCountdown);
        });
        
        // ===== USUALS AUTO-SCANNER =====
        let usualsInterval = null;
        let usualsCountdown = null;
        let usualsTimeLeft = 15 * 60; // 15 minutes in seconds
        let usualsStats = {
            totalScans: 0,
            lastScan: null,
            patternsFound: 0
        };
        
        const USUALS_TICKERS = ['SOFI', 'INTC', 'SPY', 'TSLA', 'COIN', 'CDE', 'PLTR', 'AAPL', 'BAC', 'NVDA', 'GOOGL', 'META', 'MSFT', 'UNH'];
        
        // Load usuals stats from localStorage
        function loadUsualsStats() {
            const saved = localStorage.getItem('usualsStats');
            if (saved) {
                const data = JSON.parse(saved);
                const today = new Date().toDateString();
                if (data.date === today) {
                    usualsStats = data.stats;
                    updateUsualsStatsDisplay();
                }
            }
        }
        
        function saveUsualsStats() {
            localStorage.setItem('usualsStats', JSON.stringify({
                date: new Date().toDateString(),
                stats: usualsStats
            }));
        }
        
        function updateUsualsStatsDisplay() {
            document.getElementById('usualsTotalScans').textContent = usualsStats.totalScans;
            document.getElementById('usualsLastScan').textContent = usualsStats.lastScan || 'Never';
            document.getElementById('usualsPatterns').textContent = usualsStats.patternsFound;
        }
        
        function updateUsualsTimer() {
            const minutes = Math.floor(usualsTimeLeft / 60);
            const seconds = usualsTimeLeft % 60;
            const timerElement = document.getElementById('usualsTimer');
            if (timerElement) {
                timerElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }
        }
        
        function startUsualsCountdown() {
            if (usualsCountdown) clearInterval(usualsCountdown);
            
            usualsCountdown = setInterval(() => {
                usualsTimeLeft--;
                if (usualsTimeLeft < 0) {
                    usualsTimeLeft = 15 * 60;
                }
                updateUsualsTimer();
            }, 1000);
        }
        
        async function performUsualsScan() {
            console.log('‚≠ê Usuals scanning...');
            
            const loadingDiv = document.getElementById('usualsLoading');
            const resultsDiv = document.getElementById('usualsResults');
            
            loadingDiv.classList.add('active');
            
            try {
                const response = await fetch('/api/usuals-scan', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ tickers: USUALS_TICKERS })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    usualsStats.totalScans++;
                    usualsStats.lastScan = new Date().toLocaleTimeString();
                    
                    // Count patterns
                    let patternsCount = 0;
                    data.results.forEach(stock => {
                        if (stock.patterns) {
                            patternsCount += Object.values(stock.patterns).filter(p => p !== null).length;
                        }
                    });
                    usualsStats.patternsFound = patternsCount;
                    
                    saveUsualsStats();
                    updateUsualsStatsDisplay();
                    displayUsualsResults(data.results);
                }
            } catch (error) {
                console.error('Usuals scan error:', error);
            } finally {
                loadingDiv.classList.remove('active');
            }
        }
        
        function displayUsualsResults(stocks) {
            const resultsDiv = document.getElementById('usualsResults');
            resultsDiv.classList.add('active');
            
            if (stocks.length === 0) {
                resultsDiv.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px; background: var(--card-bg); border-radius: 15px; margin-top: 20px;">
                        <h3 style="font-size: 1.8em; margin-bottom: 15px;">‚≠ê Loading Usuals...</h3>
                        <p style="font-size: 1.1em; color: var(--text-secondary);">
                            First scan in progress...
                        </p>
                    </div>
                `;
                return;
            }
            
            let html = `
                <div class="results-header">
                    <h2>‚≠ê The Usuals - Real-Time Updates</h2>
                    <p style="opacity: 0.8; margin-top: 10px;">Updated: ${new Date().toLocaleString()}</p>
                </div>
            `;
            
            stocks.forEach((stock, idx) => {
                // Determine volume status
                const volRatio = stock.volume_ratio || 1;
                const volStatus = volRatio >= 1.5 ? 'HIGH' : volRatio >= 1.0 ? 'NORMAL' : 'LOW';
                const volColor = volRatio >= 1.5 ? '#10b981' : volRatio >= 1.0 ? '#f59e0b' : '#ef4444';
                
                // Check for patterns
                const patterns = stock.patterns || {};
                const hasPatterns = Object.values(patterns).some(p => p !== null);
                
                // Get news
                const news = stock.news || [];
                
                html += `
                    <div class="stock-card" style="${hasPatterns ? 'border-left: 5px solid #10b981;' : ''}">
                        <div class="stock-header">
                            <div class="header-left">
                                <button class="favorite-btn" onclick="addToFavorites('${stock.ticker}', '${stock.company}', 'usuals')" title="Add to favorites">
                                    ‚≠ê
                                </button>
                                <div>
                                    <div class="stock-ticker">${stock.ticker}</div>
                                    <div class="stock-company">${stock.company}</div>
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 1.4em; font-weight: bold; color: ${stock.change >= 0 ? '#10b981' : '#ef4444'};">
                                    $${stock.price.toFixed(2)}
                                </div>
                                <div style="color: ${stock.change >= 0 ? '#10b981' : '#ef4444'}; font-weight: bold;">
                                    ${stock.change >= 0 ? '+' : ''}${stock.change.toFixed(2)}%
                                </div>
                            </div>
                        </div>
                        
                        <!-- Volume Section -->
                        <div style="background: var(--settings-bg); padding: 15px; border-radius: 10px; margin-top: 15px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
                                <div>
                                    <h4 style="color: #f59e0b; margin-bottom: 5px;">üìä Volume Analysis</h4>
                                    <p style="color: var(--text-secondary); margin: 0;">
                                        Current: ${stock.volume.toLocaleString()} | Avg: ${stock.avg_volume.toLocaleString()}
                                    </p>
                                </div>
                                <div class="badge" style="background: ${volColor}; color: white; padding: 8px 16px; border-radius: 20px; font-weight: bold;">
                                    ${volStatus} (${volRatio.toFixed(2)}x)
                                </div>
                            </div>
                        </div>
                        
                        <!-- Patterns Section -->
                        <div class="metrics-grid" style="margin-top: 15px;">
                            <div class="metric-section">
                                <h4>üìà Pattern Detection</h4>
                                ${patterns.daily ? `
                                    <div class="metric-item" style="background: rgba(16, 185, 129, 0.1); padding: 8px; border-radius: 5px; margin-bottom: 5px;">
                                        <span class="metric-label">Daily:</span>
                                        <span class="metric-value" style="color: #10b981;">
                                            ${patterns.daily.direction === 'bullish' ? 'üìà' : 'üìâ'} ${patterns.daily.type}
                                        </span>
                                    </div>
                                ` : '<div class="metric-item"><span class="metric-label">Daily:</span><span class="metric-value">No pattern</span></div>'}
                                
                                ${patterns.weekly ? `
                                    <div class="metric-item" style="background: rgba(16, 185, 129, 0.1); padding: 8px; border-radius: 5px; margin-bottom: 5px;">
                                        <span class="metric-label">Weekly:</span>
                                        <span class="metric-value" style="color: #10b981;">
                                            ${patterns.weekly.direction === 'bullish' ? 'üìà' : 'üìâ'} ${patterns.weekly.type}
                                        </span>
                                    </div>
                                ` : '<div class="metric-item"><span class="metric-label">Weekly:</span><span class="metric-value">No pattern</span></div>'}
                                
                                ${patterns.hourly ? `
                                    <div class="metric-item" style="background: rgba(16, 185, 129, 0.1); padding: 8px; border-radius: 5px; margin-bottom: 5px;">
                                        <span class="metric-label">Hourly:</span>
                                        <span class="metric-value" style="color: #10b981;">
                                            ${patterns.hourly.direction === 'bullish' ? 'üìà' : 'üìâ'} ${patterns.hourly.type}
                                        </span>
                                    </div>
                                ` : '<div class="metric-item"><span class="metric-label">Hourly:</span><span class="metric-value">No pattern</span></div>'}
                                
                                ${patterns.four_hour ? `
                                    <div class="metric-item" style="background: rgba(16, 185, 129, 0.1); padding: 8px; border-radius: 5px;">
                                        <span class="metric-label">4-Hour:</span>
                                        <span class="metric-value" style="color: #10b981;">
                                            ${patterns.four_hour.direction === 'bullish' ? 'üìà' : 'üìâ'} ${patterns.four_hour.type}
                                        </span>
                                    </div>
                                ` : '<div class="metric-item"><span class="metric-label">4-Hour:</span><span class="metric-value">No pattern</span></div>'}
                            </div>
                            
                            <div class="metric-section">
                                <h4>üì∞ Latest News</h4>
                                ${news.length > 0 ? news.map(item => `
                                    <div style="background: rgba(245, 158, 11, 0.1); padding: 10px; border-radius: 5px; margin-bottom: 8px;">
                                        <a href="${item.url}" target="_blank" style="color: var(--text-primary); text-decoration: none; font-weight: 500; display: block; margin-bottom: 3px;">
                                            üìå ${item.title}
                                        </a>
                                        <span style="font-size: 0.85em; color: var(--text-secondary);">
                                            ${item.source} ‚Ä¢ ${item.time}
                                        </span>
                                    </div>
                                `).join('') : '<p style="color: var(--text-secondary);">No recent news</p>'}
                            </div>
                        </div>
                        
                        <div class="chart-container" id="chart-${stock.ticker}-usuals-${idx}"></div>
                    </div>
                `;
            });
            
            resultsDiv.innerHTML = html;
            
            // Create charts
            stocks.forEach((stock, idx) => {
                setTimeout(() => createChart(`chart-${stock.ticker}-usuals-${idx}`, stock.ticker, 'daily'), 200 + (idx * 100));
            });
        }
        
        // Start Usuals on page load
        function startUsualsAutoScanner() {
            console.log('‚≠ê Starting Usuals auto-scanner...');
            loadUsualsStats();
            
            // Initial scan
            performUsualsScan();
            
            // Set up 15-minute interval
            usualsInterval = setInterval(() => {
                performUsualsScan();
                usualsTimeLeft = 15 * 60;
            }, 15 * 60 * 1000);
            
            // Start countdown
            startUsualsCountdown();
        }
        
        // Initialize Usuals when page loads
        window.addEventListener('DOMContentLoaded', () => {
            startUsualsAutoScanner();
        });
        
        // Cleanup on unload
        window.addEventListener('beforeunload', () => {
            if (usualsInterval) clearInterval(usualsInterval);
            if (usualsCountdown) clearInterval(usualsCountdown);
        });
    </script>
</body>
</html>
